<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.0</version>
    <date>2020-09-04T15:37:57Z</date>
    <groups>
        <group>
            <name>Production</name>
        </group>
        <group>
            <name>PVE LXC</name>
        </group>
        <group>
            <name>PVE Node</name>
        </group>
        <group>
            <name>PVE Qemu</name>
        </group>
        <group>
            <name>Templates</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template pve api datacenter</template>
            <name>Template pve api datacenter</name>
            <description>This template monitors a Proxmox system. It requires access to port 8006 either from the zabbix server or from a zabbix proxy. It will not work through a zabbix agent.&#13;
The template requires a Proxmox API key for access to the Proxmox API. The values should be set in the following macro's:&#13;
{$PVESERVER} : Server to talk to for the API&#13;
{$PVETOKENID} : API token ID&#13;
{$PVESECRET} : API secret</description>
            <templates>
                <template>
                    <name>Template pve api settings</name>
                </template>
            </templates>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>PVE Datacenter</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Cluster nodes</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.clusternodes</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>PVE Datacenter</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.type == &quot;node&quot;)].length()</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                </item>
                <item>
                    <name>Cluster nodes online</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.clusternodesonline</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>PVE Datacenter</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.type == &quot;node&quot; &amp;&amp; @.status == &quot;online&quot;)].length()</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                </item>
                <item>
                    <name>pveapi datacenter master resources</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.datacenter.master.resources</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <description>Item specifically does not use cluster/config/nodes as that has no information for single node systems.</description>
                    <applications>
                        <application>
                            <name>PVE Datacenter</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/cluster/resources</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <triggers>
                        <trigger>
                            <expression>{nodata({$PVEAPITIMEOUT})}=1</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{nodata({$PVEAPITIMEOUT})}=0</recovery_expression>
                            <name>{$PVESERVER} Proxmox API unreachable ({$PVEAPITIMEOUT})</name>
                            <priority>DISASTER</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>pveapi datacenter master tasks</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.datacenter.master.tasks</key>
                    <applications>
                        <application>
                            <name>PVE Datacenter</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.status != &quot;OK&quot;)].id.length()</params>
                        </step>
                    </preprocessing>
                    <url>https://{$PVESERVER}:8006/api2/json/cluster/tasks</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <triggers>
                        <trigger>
                            <expression>{last(#1)} &gt; {last(#2)}</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>{$PVESERVER} tasks failed</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>pveapi datacenter discovery lxc</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.discovery.lxc</key>
                    <delay>0</delay>
                    <host_prototypes>
                        <host_prototype>
                            <host>lxc {#PVELXCNAME}</host>
                            <name>{#PVELXCNAME} (on {#PVENODE}:{#PVELXCID})</name>
                            <group_links>
                                <group_link>
                                    <group>
                                        <name>PVE LXC</name>
                                    </group>
                                </group_link>
                            </group_links>
                            <group_prototypes>
                                <group_prototype>
                                    <name>{#PVENODE} (lxc)</name>
                                </group_prototype>
                            </group_prototypes>
                            <templates>
                                <template>
                                    <name>Template pve api lxc</name>
                                </template>
                            </templates>
                            <macros>
                                <macro>
                                    <macro>{$PVELXCID}</macro>
                                    <value>{#PVELXCID}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVELXCNAME}</macro>
                                    <value>{#PVELXCNAME}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVELXCPOOL}</macro>
                                    <value>{#PVELXCPOOL}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVENODE}</macro>
                                    <value>{#PVENODE}</value>
                                </macro>
                            </macros>
                        </host_prototype>
                    </host_prototypes>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVELXCID}</lld_macro>
                            <path>$.vmid</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVELXCNAME}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVELXCPOOL}</lld_macro>
                            <path>$.pool</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVENODE}</lld_macro>
                            <path>$.node</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.type == &quot;lxc&quot;)]</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>pveapi datacenter discovery node</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.discovery.node</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>Node {#PVENODE} online</name>
                            <type>DEPENDENT</type>
                            <key>pxeapi.datacenter.node.online[{#PVENODE}]</key>
                            <delay>0</delay>
                            <applications>
                                <application>
                                    <name>PVE Datacenter</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data[?(@.node== &quot;{#PVENODE}&quot; &amp;&amp; @.status == &quot;online&quot;)].status.length()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.datacenter.master.resources</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=0</expression>
                                    <name>Node {#PVENODE} offline</name>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <host_prototypes>
                        <host_prototype>
                            <host>node {#PVENODE}</host>
                            <name>{#PVENODE}</name>
                            <group_links>
                                <group_link>
                                    <group>
                                        <name>PVE Node</name>
                                    </group>
                                </group_link>
                            </group_links>
                            <templates>
                                <template>
                                    <name>Template pve api node</name>
                                </template>
                            </templates>
                            <macros>
                                <macro>
                                    <macro>{$PVENODE}</macro>
                                    <value>{#PVENODE}</value>
                                </macro>
                            </macros>
                        </host_prototype>
                    </host_prototypes>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODE}</lld_macro>
                            <path>$.node</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.type == &quot;node&quot;)]</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>pveapi datacenter discovery qemu</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.discovery.qemu</key>
                    <delay>0</delay>
                    <host_prototypes>
                        <host_prototype>
                            <host>qemu {#PVEQEMUNAME}</host>
                            <name>{#PVEQEMUNAME} (on {#PVENODE}:{#PVEQEMUID})</name>
                            <group_links>
                                <group_link>
                                    <group>
                                        <name>PVE Qemu</name>
                                    </group>
                                </group_link>
                            </group_links>
                            <group_prototypes>
                                <group_prototype>
                                    <name>{#PVENODE} (qemu)</name>
                                </group_prototype>
                            </group_prototypes>
                            <templates>
                                <template>
                                    <name>Template pve api qemu</name>
                                </template>
                            </templates>
                            <macros>
                                <macro>
                                    <macro>{$PVENODE}</macro>
                                    <value>{#PVENODE}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVEQEMUID}</macro>
                                    <value>{#PVEQEMUID}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVEQEMUNAME}</macro>
                                    <value>{#PVEQEMUNAME}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVEQEMUPOOL}</macro>
                                    <value>{#PVEQEMUPOOL}</value>
                                </macro>
                            </macros>
                        </host_prototype>
                    </host_prototypes>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODE}</lld_macro>
                            <path>$.node</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUID}</lld_macro>
                            <path>$.vmid</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUNAME}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUPOOL}</lld_macro>
                            <path>$.pool</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.type == &quot;qemu&quot;)]</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <screens>
                <screen>
                    <name>Cluster status</name>
                    <hsize>2</hsize>
                    <vsize>1</vsize>
                    <screen_items>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Cluster status</name>
                                <host>Template pve api datacenter</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                    </screen_items>
                </screen>
            </screens>
        </template>
        <template>
            <template>Template pve api lxc</template>
            <name>Template pve api lxc</name>
            <description>This template is used by Template pve api datacenter. Please don't use directly.</description>
            <templates>
                <template>
                    <name>Template pve api settings</name>
                </template>
            </templates>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>PVE LXC</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>CPU</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.cpu</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.cpu</params>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>100</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>CPUs</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.cpus</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.cpus</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Disk used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.disk</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.disk</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Disk free</name>
                    <type>CALCULATED</type>
                    <key>pveapi.lxc.diskfree</key>
                    <units>%</units>
                    <params>100*(last(pveapi.lxc.maxdisk) - last(pveapi.lxc.disk)) / last(pveapi.lxc.maxdisk)</params>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Disk read</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.diskread</key>
                    <delay>0</delay>
                    <units>Bps</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.diskread</params>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <params/>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Disk write</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.diskwrite</key>
                    <delay>0</delay>
                    <units>Bps</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.diskwrite</params>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <params/>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Lock</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.lock</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.lock</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>pveapi lxc master snapshot</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.lxc.master.snapshot</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/lxc/{$PVELXCID}/snapshot</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <allow_traps>YES</allow_traps>
                </item>
                <item>
                    <name>pveapi lxc master status</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.lxc.master.status</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/lxc/{$PVELXCID}/status/current</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>Disk size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.maxdisk</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.maxdisk</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.maxmem</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.maxmem</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Swap size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.maxswap</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.maxswap</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.mem</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.mem</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory free</name>
                    <type>CALCULATED</type>
                    <key>pveapi.lxc.memfree</key>
                    <units>%</units>
                    <params>100*((last(pveapi.lxc.maxmem)+last(pveapi.lxc.maxswap)) - (last(pveapi.lxc.mem)+last(pveapi.lxc.swap)) / (last(pveapi.lxc.maxmem)+last(pveapi.lxc.maxswap)))</params>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Net in</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.netin</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.netin</params>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>8</params>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <params/>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Net out</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.netout</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.netout</params>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>8</params>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <params/>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Pool check</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.lxc.poolcheck</key>
                    <delay>15m</delay>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.poolid==&quot;{$PVELXCPOOL}&quot;)].poolid.first()</params>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>__</error_handler_params>
                        </step>
                        <step>
                            <type>MATCHES_REGEX</type>
                            <params>^{$PVETESTPOOL}</params>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>1</error_handler_params>
                        </step>
                        <step>
                            <type>NOT_MATCHES_REGEX</type>
                            <params>^{$PVETESTPOOL}</params>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>0</error_handler_params>
                        </step>
                    </preprocessing>
                    <url>https://{$PVESERVER}:8006/api2/json/pools</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>Status</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.status</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.status</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Swap used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.swap</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.swap</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.uptime</key>
                    <delay>0</delay>
                    <units>uptime</units>
                    <applications>
                        <application>
                            <name>PVE LXC</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.uptime</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>pveapi lxc discovery snapshot</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.snapshot.discovery</key>
                    <delay>0</delay>
                    <lifetime>1h</lifetime>
                    <description>Discover snapshots for lxc.</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>Snapshot {#PVELXCSNAPSHOT} check</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.lxc.snapshot.check[{#PVELXCSNAPSHOT}]</key>
                            <delay>0</delay>
                            <history>1h</history>
                            <trends>0</trends>
                            <applications>
                                <application>
                                    <name>PVE LXC</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data[?(@.name==&quot;{#PVELXCSNAPSHOT}&quot; &amp;&amp; ! (@.name =~ &quot;^{$PVESNAPSHOTEXCLUDE}&quot;))].length()</params>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.lxc.master.snapshot</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Snapshot {#PVELXCSNAPSHOT} create time</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.lxc.snapshot.time[{#PVELXCSNAPSHOT}]</key>
                            <delay>0</delay>
                            <history>1h</history>
                            <trends>0</trends>
                            <units>unixtime</units>
                            <applications>
                                <application>
                                    <name>PVE LXC</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data[?(@.name==&quot;{#PVELXCSNAPSHOT}&quot;)].snaptime.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.lxc.master.snapshot</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{Template pve api lxc:pveapi.lxc.snapshot.time[{#PVELXCSNAPSHOT}].now(0)}-&#13;
{Template pve api lxc:pveapi.lxc.snapshot.time[{#PVELXCSNAPSHOT}].last(0)}&gt;{$PVESNAPSHOTAGE} and {Template pve api lxc:pveapi.lxc.snapshot.check[{#PVELXCSNAPSHOT}].last(0)}=1</expression>
                            <name>{$PVELXCNAME} snapshot {#PVELXCSNAPSHOT} too old</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <master_item>
                        <key>pveapi.lxc.master.snapshot</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVELXCSNAPSHOT}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.name!=&quot;current&quot;)]</params>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>{ &quot;data&quot;:[] }</error_handler_params>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <screens>
                <screen>
                    <name>LXC overview</name>
                    <hsize>2</hsize>
                    <vsize>4</vsize>
                    <screen_items>
                        <screen_item>
                            <resourcetype>3</resourcetype>
                            <style>0</style>
                            <resource>
                                <key>pveapi.lxc.status</key>
                                <host>Template pve api lxc</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>1</elements>
                            <valign>1</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>CPU</name>
                                <host>Template pve api lxc</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>1</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Uptime</name>
                                <host>Template pve api lxc</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>1</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Memory usage</name>
                                <host>Template pve api lxc</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>2</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Swap usage</name>
                                <host>Template pve api lxc</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>2</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Disk usage</name>
                                <host>Template pve api lxc</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>3</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Network traffic</name>
                                <host>Template pve api lxc</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>3</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                    </screen_items>
                </screen>
            </screens>
        </template>
        <template>
            <template>Template pve api node</template>
            <name>Template pve api node</name>
            <description>This template is used by Template pve api datacenter. Please don't use directly.</description>
            <templates>
                <template>
                    <name>Template pve api settings</name>
                </template>
            </templates>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>PVE Node</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>CPU user</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.cpu.user</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.cpu</params>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>100</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>CPU wait</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.cpu.wait</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.wait</params>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>100</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>CPUs</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.cpus</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.cpuinfo.cpus</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>Kernel version</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.kernelversion</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.kversion</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>KSM</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.ksm</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.ksm.shared</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>Load average</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.load</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.loadavg[0]</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>pveapi node master status</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/status</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>pveapi node master disks</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.disks</key>
                    <delay>1h</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/disks/list</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>pveapi node master lvm</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.lvm</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/disks/lvm</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>pveapi node master lvmthin</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.lvmthin</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/disks/lvmthin</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>pveapi node master services</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.services</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/services</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>pveapi node master storagepools</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.storagepools</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/storage</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>pveapi node master zfs</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.zfs</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/disks/zfs</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>Memory size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.mem.total</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.memory.total</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.mem.used</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.memory.used</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>PVE version</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.pveversion</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.pveversion</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>Root filesystem size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.rootfs.total</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.rootfs.total</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>Root filesystem used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.rootfs.used</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.rootfs.used</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>Swap size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.swap.total</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.swap.total</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>Swap used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.swap.used</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.swap.used</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                </item>
                <item>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.uptime</key>
                    <delay>0</delay>
                    <units>uptime</units>
                    <applications>
                        <application>
                            <name>PVE Node</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.uptime</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{change(0)}&lt;0</expression>
                            <name>{$PVENODE} is restarted</name>
                            <priority>INFO</priority>
                            <description>{$PVENODE} restarted</description>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>pveapi node discovery disks</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.disks</key>
                    <delay>0</delay>
                    <status>DISABLED</status>
                    <item_prototypes>
                        <item_prototype>
                            <name>Disk {#PVENODEDISK} health</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.disk.health[{#PVENODEDISK}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data[?(@.devpath==&quot;{#PVENODEDISK}&quot;)].health.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.disks</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{regexp(PASSED|OK)}=0</expression>
                                    <name>{$PVENODE} disk {#PVENODEDISK} health failed</name>
                                    <priority>DISASTER</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Disk {#PVENODEDISK} wearout</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.disk.wearout[{#PVENODEDISK}]</key>
                            <delay>0</delay>
                            <units>%</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data[?(@.devpath==&quot;{#PVENODEDISK}&quot;)].wearout.first()</params>
                                </step>
                                <step>
                                    <type>NOT_MATCHES_REGEX</type>
                                    <params>N/A</params>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.disks</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&lt;=10</expression>
                                    <name>{$PVENODE} disk {#PVENODEDISK} wearout 10% left</name>
                                    <priority>HIGH</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}&lt;=20</expression>
                                    <name>{$PVENODE} disk {#PVENODEDISK} wearout 20% left</name>
                                    <priority>AVERAGE</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>Disk wearout ({{HOST.HOST}:pveapi.node.disk.health[{#PVENODEDISK}].last()})</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>FIXED</ymax_type_1>
                            <graph_items>
                                <graph_item>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.disk.wearout[{#PVENODEDISK}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.node.master.disks</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODEDISK}</lld_macro>
                            <path>$.devpath</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>pveapi node discovery lvm</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.lvm</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>LVM {#PVENODELVM} free</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvm.free[{#PVENODELVM}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.children.[?(@.name==&quot;{#PVENODELVM}&quot;)].free.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvm</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>LVM {#PVENODELVM} size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvm.size[{#PVENODELVM}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.children.[?(@.name==&quot;{#PVENODELVM}&quot;)].size.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvm</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>pveapi.node.master.lvm</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODELVM}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.children</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>pveapi node discovery lvmthin</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.lvmthin</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>LVMThin {#PVENODELVMTHIN} metadata size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.lv==&quot;{#PVENODELVMTHIN}&quot;)].metadata_size.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvmthin</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>LVMThin {#PVENODELVMTHIN} metadata used</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.lv==&quot;{#PVENODELVMTHIN}&quot;)].metadata_used.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvmthin</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>LVMThin {#PVENODELVMTHIN} size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvmthin.size[{#PVENODELVMTHIN}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.lv==&quot;{#PVENODELVMTHIN}&quot;)].lv_size.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvmthin</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>LVMThin {#PVENODELVMTHIN} used</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvmthin.used[{#PVENODELVMTHIN}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.lv==&quot;{#PVENODELVMTHIN}&quot;)].used.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvmthin</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}].last(0)}))&#13;
&gt; 98</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}].last(0)}))&#13;
&lt; 95</recovery_expression>
                            <name>{$PVENODE} lvm thin metadata {#PVENODELVMTHIN} less then 2% free</name>
                            <priority>DISASTER</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}].last(0)}))&#13;
&gt; 90</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}].last(0)})) &lt; 88</recovery_expression>
                            <name>{$PVENODE} lvm thin metadata {#PVENODELVMTHIN} less then 10% free</name>
                            <priority>HIGH</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}].last(0)}))&#13;
&gt; 80</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}].last(0)}))&#13;
&lt; 75</recovery_expression>
                            <name>{$PVENODE} lvm thin metadata {#PVENODELVMTHIN} less then 20% free</name>
                            <priority>WARNING</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.lvmthin.used[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.size[{#PVENODELVMTHIN}].last(0)}))&#13;
&gt; 98</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.lvmthin.used[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.size[{#PVENODELVMTHIN}].last(0)}))&#13;
&lt; 95</recovery_expression>
                            <name>{$PVENODE} lvm thin {#PVENODELVMTHIN} less then 2% free</name>
                            <priority>DISASTER</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.lvmthin.used[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.size[{#PVENODELVMTHIN}].last(0)}))&#13;
&gt; 90</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.lvmthin.used[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.size[{#PVENODELVMTHIN}].last(0)}))&#13;
&lt; 88</recovery_expression>
                            <name>{$PVENODE} lvm thin {#PVENODELVMTHIN} less then 10% free</name>
                            <priority>HIGH</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.lvmthin.used[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.size[{#PVENODELVMTHIN}].last(0)}))&#13;
&gt; 80</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.lvmthin.used[{#PVENODELVMTHIN}].last(0)}/&#13;
{Template pve api node:pveapi.node.lvmthin.size[{#PVENODELVMTHIN}].last(0)}))&#13;
&lt; 75</recovery_expression>
                            <name>{$PVENODE} lvm thin {#PVENODELVMTHIN} less then 20% free</name>
                            <priority>WARNING</priority>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>LVMThin {#PVENODELVMTHIN} metadata usage</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>Template pve api node</host>
                                <key>pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <name>LVMThin {#PVENODELVMTHIN} usage</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>Template pve api node</host>
                                <key>pveapi.node.lvmthin.size[{#PVENODELVMTHIN}]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.lvmthin.used[{#PVENODELVMTHIN}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.node.master.lvmthin</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODELVMTHIN}</lld_macro>
                            <path>$.lv</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>pveapi node discovery services</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.services</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>service {#PVENODESERVICE}</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.services.state[{#PVENODESERVICE}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.name==&quot;{#PVENODESERVICE}&quot;)].state.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.services</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{regexp(running)}=0</expression>
                                    <name>{$PVENODE} service {#PVENODESERVICE} not running</name>
                                    <priority>AVERAGE</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>pveapi.node.master.services</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODESERVICE}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>pveapi node discovery storage pools</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.storagepool</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>storage pool {#PVENODESTORAGEPOOL} size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.storage==&quot;{#PVENODESTORAGEPOOL}&quot;)].total.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.storagepools</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>storage pool {#PVENODESTORAGEPOOL} used</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.storage==&quot;{#PVENODESTORAGEPOOL}&quot;)].used.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.storagepools</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}].last(0)}))&#13;
&gt; 98</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}].last(0)}))&#13;
&lt; 95</recovery_expression>
                            <name>{$PVENODE} storage pool {#PVENODESTORAGEPOOL} less then 2% free</name>
                            <priority>DISASTER</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}].last(0)}))&#13;
&gt; 90</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}].last(0)}))&#13;
&lt; 88</recovery_expression>
                            <name>{$PVENODE} storage pool {#PVENODESTORAGEPOOL} less then 10% free</name>
                            <priority>HIGH</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}].last(0)}))&#13;
&gt; 80</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}].last(0)}))&#13;
&lt; 75</recovery_expression>
                            <name>{$PVENODE} storage pool {#PVENODESTORAGEPOOL} less then 20% free</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>storage pool {#PVENODESTORAGEPOOL} usage ({#PVENODESTORAGEPOOLTYPE})</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>Template pve api node</host>
                                <key>pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.node.master.storagepools</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODESTORAGEPOOLTYPE}</lld_macro>
                            <path>$.type</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVENODESTORAGEPOOL}</lld_macro>
                            <path>$.storage</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>pveapi node discovery zfs</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.zfs</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>zpool {#PVENODEZFSPOOL} allocated</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.name==&quot;{#PVENODEZFSPOOL}&quot;)].alloc.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.zfs</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>zpool {#PVENODEZFSPOOL} fragmented</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.zfs.frag[{#PVENODEZFSPOOL}]</key>
                            <delay>0</delay>
                            <units>%</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.name==&quot;{#PVENODEZFSPOOL}&quot;)].frag.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.zfs</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>zpool {#PVENODEZFSPOOL} health</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.zfs.health[{#PVENODEZFSPOOL}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.name==&quot;{#PVENODEZFSPOOL}&quot;)].health.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.zfs</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{regexp(ONLINE)}=0</expression>
                                    <name>{$PVENODE} zpool {#PVENODEZFSPOOL} health failed</name>
                                    <priority>DISASTER</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>zpool {#PVENODEZFSPOOL} size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.zfs.size[{#PVENODEZFSPOOL}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <applications>
                                <application>
                                    <name>PVE Node</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.[?(@.name==&quot;{#PVENODEZFSPOOL}&quot;)].size.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.zfs</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.zfs.size[{#PVENODEZFSPOOL}].last(0)}))&#13;
&gt; 98</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.zfs.size[{#PVENODEZFSPOOL}].last(0)}))&#13;
&lt; 95</recovery_expression>
                            <name>{$PVENODE} zpool {#PVENODEZFSPOOL} less then 2% free</name>
                            <priority>DISASTER</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.zfs.size[{#PVENODEZFSPOOL}].last(0)}))&#13;
&gt; 90</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.zfs.size[{#PVENODEZFSPOOL}].last(0)}))&#13;
&lt; 88</recovery_expression>
                            <name>{$PVENODE} zpool {#PVENODEZFSPOOL} less then 10% free</name>
                            <priority>HIGH</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>(100*({Template pve api node:pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.zfs.size[{#PVENODEZFSPOOL}].last(0)}))&#13;
&gt; 80</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*({Template pve api node:pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}].last(0)}/&#13;
{Template pve api node:pveapi.node.zfs.size[{#PVENODEZFSPOOL}].last(0)}))&#13;
&lt; 75</recovery_expression>
                            <name>{$PVENODE} zpool {#PVENODEZFSPOOL} less then 20% free</name>
                            <priority>WARNING</priority>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>zpool {#PVENODEZFSPOOL} fragmentation</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>FIXED</ymax_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>2774A4</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.zfs.frag[{#PVENODEZFSPOOL}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <name>zpool {#PVENODEZFSPOOL} usage ({{HOST.HOST}:pveapi.node.zfs.health[{#PVENODEZFSPOOL}].last()})</name>
                            <type>STACKED</type>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>Template pve api node</host>
                                <key>pveapi.node.zfs.size[{#PVENODEZFSPOOL}]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.node.master.zfs</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODEZFSPOOL}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <screens>
                <screen>
                    <name>Disk</name>
                    <hsize>1</hsize>
                    <vsize>1</vsize>
                    <screen_items>
                        <screen_item>
                            <resourcetype>19</resourcetype>
                            <style>0</style>
                            <resource>
                                <key>pveapi.node.disk.wearout[{#PVENODEDISK}]</key>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                    </screen_items>
                </screen>
                <screen>
                    <name>LVMThin storage</name>
                    <hsize>2</hsize>
                    <vsize>1</vsize>
                    <screen_items>
                        <screen_item>
                            <resourcetype>20</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>LVMThin {#PVENODELVMTHIN} usage</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>20</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>LVMThin {#PVENODELVMTHIN} metadata usage</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                    </screen_items>
                </screen>
                <screen>
                    <name>Overview</name>
                    <hsize>2</hsize>
                    <vsize>4</vsize>
                    <screen_items>
                        <screen_item>
                            <resourcetype>3</resourcetype>
                            <style>0</style>
                            <resource>
                                <key>pveapi.node.pveversion</key>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>1</elements>
                            <valign>1</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>3</resourcetype>
                            <style>0</style>
                            <resource>
                                <key>pveapi.node.kernelversion</key>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>1</elements>
                            <valign>1</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>CPU ({{HOST.HOST}:pveapi.node.cpus.last(0)} CPU(s))</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>1</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Load average</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>1</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Memory ({{HOST.HOST}:pveapi.node.mem.total.last(0)})</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>2</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Swap ({{HOST.HOST}:pveapi.node.swap.total.last(0)})</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>2</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Root filesystem ({{HOST.HOST}:pveapi.node.rootfs.total.last(0)})</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>3</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>KSM</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>3</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                    </screen_items>
                </screen>
                <screen>
                    <name>Storage pools</name>
                    <hsize>1</hsize>
                    <vsize>1</vsize>
                    <screen_items>
                        <screen_item>
                            <resourcetype>20</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>storage pool {#PVENODESTORAGEPOOL} usage ({#PVENODESTORAGEPOOLTYPE})</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                    </screen_items>
                </screen>
                <screen>
                    <name>ZFS storage</name>
                    <hsize>2</hsize>
                    <vsize>1</vsize>
                    <screen_items>
                        <screen_item>
                            <resourcetype>20</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>zpool {#PVENODEZFSPOOL} usage ({{HOST.HOST}:pveapi.node.zfs.health[{#PVENODEZFSPOOL}].last()})</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>1</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>20</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>zpool {#PVENODEZFSPOOL} fragmentation</name>
                                <host>Template pve api node</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>1</max_columns>
                        </screen_item>
                    </screen_items>
                </screen>
            </screens>
        </template>
        <template>
            <template>Template pve api qemu</template>
            <name>Template pve api qemu</name>
            <description>This template is used by Template pve api datacenter. Please don't use directly.</description>
            <templates>
                <template>
                    <name>Template pve api settings</name>
                </template>
            </templates>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>PVE Qemu</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>CPU</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.cpu</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.cpu</params>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>100</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>CPUs</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.cpus</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.cpus</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>pveapi qemu master snapshot</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.qemu.master.snapshot</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/qemu/{$PVEQEMUID}/snapshot</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>pveapi qemu master status</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.qemu.master.status</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/qemu/{$PVEQEMUID}/status/current</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>Disk size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.maxdisk</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.maxdisk</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.maxmem</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.maxmem</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Memory used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.mem</key>
                    <delay>0</delay>
                    <units>B</units>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.mem</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Pool check</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.qemu.poolcheck</key>
                    <delay>15m</delay>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.poolid==&quot;{$PVEQEMUPOOL}&quot;)].poolid.first()</params>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>__</error_handler_params>
                        </step>
                        <step>
                            <type>MATCHES_REGEX</type>
                            <params>^{$PVETESTPOOL}</params>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>1</error_handler_params>
                        </step>
                        <step>
                            <type>NOT_MATCHES_REGEX</type>
                            <params>^{$PVETESTPOOL}</params>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>0</error_handler_params>
                        </step>
                    </preprocessing>
                    <url>https://{$PVESERVER}:8006/api2/json/pools</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <name>Status</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.status</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.status</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                </item>
                <item>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.uptime</key>
                    <delay>0</delay>
                    <units>uptime</units>
                    <applications>
                        <application>
                            <name>PVE Qemu</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.uptime</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>pveapi qemu discovery blockdevice</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.discovery.blockdev</key>
                    <delay>0</delay>
                    <description>Discover blockdevices for qemu.&#13;
The preprocessing is pretty gross. Need to modify an array to items with names.</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#PVEQEMUBLOCKDEV} read iops</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.blockdev.readiops[{#PVEQEMUBLOCKDEV}]</key>
                            <delay>0</delay>
                            <units>iops</units>
                            <applications>
                                <application>
                                    <name>PVE Qemu</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.blockstat.{#PVEQEMUBLOCKDEV}.rd_operations</params>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#PVEQEMUBLOCKDEV} read</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.blockdev.read[{#PVEQEMUBLOCKDEV}]</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <units>Bps</units>
                            <applications>
                                <application>
                                    <name>PVE Qemu</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.blockstat.{#PVEQEMUBLOCKDEV}.rd_bytes</params>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#PVEQEMUBLOCKDEV} write iops</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.blockdev.writeiops[{#PVEQEMUBLOCKDEV}]</key>
                            <delay>0</delay>
                            <units>iops</units>
                            <applications>
                                <application>
                                    <name>PVE Qemu</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.blockstat.{#PVEQEMUBLOCKDEV}.wr_operations</params>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#PVEQEMUBLOCKDEV} write</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.blockdev.write[{#PVEQEMUBLOCKDEV}]</key>
                            <delay>0</delay>
                            <units>Bps</units>
                            <applications>
                                <application>
                                    <name>PVE Qemu</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.blockstat.{#PVEQEMUBLOCKDEV}.wr_bytes</params>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>{#PVEQEMUBLOCKDEV} iops</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>2774A4</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.blockdev.readiops[{#PVEQEMUBLOCKDEV}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F7941D</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.blockdev.writeiops[{#PVEQEMUBLOCKDEV}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <name>{#PVEQEMUBLOCKDEV} read/write</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.blockdev.read[{#PVEQEMUBLOCKDEV}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.blockdev.write[{#PVEQEMUBLOCKDEV}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUBLOCKDEV}</lld_macro>
                            <path>$.blockdev</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.blockstat[*]~</params>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>{ &quot;data&quot;:[] }</error_handler_params>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <params>,&quot;
},{&quot;blockdev&quot;:&quot;</params>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <params>[
[{&quot;blockdev&quot;:</params>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <params>]
}]</params>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <params>blockdev&quot;:}
blockdev&quot;:&quot;&quot;}</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>pveapi qemu discovery nic</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.discovery.nic</key>
                    <delay>0</delay>
                    <description>Discover network interfaces for qemu.&#13;
The preprocessing is pretty gross. Need to modify an array to items with names.</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#PVEQEMUNIC} in</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.nic.in[{#PVEQEMUNIC}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>PVE Qemu</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.nics.{#PVEQEMUNIC}.netin</params>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>8</params>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>{#PVEQEMUNIC} out</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.nic.out[{#PVEQEMUNIC}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <applications>
                                <application>
                                    <name>PVE Qemu</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data.nics.{#PVEQEMUNIC}.netout</params>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>8</params>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>{#PVEQEMUNIC} traffic</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.nic.in[{#PVEQEMUNIC}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.nic.out[{#PVEQEMUNIC}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUNIC}</lld_macro>
                            <path>$.nic</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data.nics[*]~</params>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <params>,&quot;
},{&quot;nic&quot;:&quot;</params>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <params>[
[{&quot;nic&quot;:</params>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <params>]
}]</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>pveapi qemu discovery snapshot</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.discovery.snapshot</key>
                    <delay>0</delay>
                    <lifetime>1h</lifetime>
                    <description>Discover snapshots for qemu.</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>Snapshot {#PVEQEMUSNAPSHOT} check</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.snapshot.check[{#PVEQEMUSNAPSHOT}]</key>
                            <delay>0</delay>
                            <history>1h</history>
                            <trends>0</trends>
                            <applications>
                                <application>
                                    <name>PVE Qemu</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data[?(@.name==&quot;{#PVEQEMUSNAPSHOT}&quot; &amp;&amp; ! (@.name =~ &quot;^{$PVESNAPSHOTEXCLUDE}&quot;))].length()</params>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.snapshot</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Snapshot {#PVEQEMUSNAPSHOT} create time</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.snapshot.time[{#PVEQEMUSNAPSHOT}]</key>
                            <delay>0</delay>
                            <history>1h</history>
                            <trends>0</trends>
                            <units>unixtime</units>
                            <applications>
                                <application>
                                    <name>PVE Qemu</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.body.data[?(@.name==&quot;{#PVEQEMUSNAPSHOT}&quot;)].snaptime.first()</params>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.snapshot</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{Template pve api qemu:pveapi.qemu.snapshot.time[{#PVEQEMUSNAPSHOT}].now(0)}-&#13;
{Template pve api qemu:pveapi.qemu.snapshot.time[{#PVEQEMUSNAPSHOT}].last(0)}&gt;{$PVESNAPSHOTAGE} and {Template pve api qemu:pveapi.qemu.snapshot.check[{#PVEQEMUSNAPSHOT}].last(0)}=1</expression>
                            <name>{$PVEQEMUNAME} snapshot {#PVEQEMUSNAPSHOT} too old</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <master_item>
                        <key>pveapi.qemu.master.snapshot</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUSNAPSHOT}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.body.data[?(@.name!=&quot;current&quot;)]</params>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <screens>
                <screen>
                    <name>Qemu overview</name>
                    <hsize>3</hsize>
                    <vsize>4</vsize>
                    <screen_items>
                        <screen_item>
                            <resourcetype>3</resourcetype>
                            <style>0</style>
                            <resource>
                                <key>pveapi.qemu.status</key>
                                <host>Template pve api qemu</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>1</elements>
                            <valign>1</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>CPU ({{HOST.HOST}:pveapi.qemu.cpus.last(0)} CPU(s))</name>
                                <host>Template pve api qemu</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>1</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Memory usage</name>
                                <host>Template pve api qemu</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>1</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>0</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Uptime</name>
                                <host>Template pve api qemu</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>2</x>
                            <y>1</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>1</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>20</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>{#PVEQEMUNIC} traffic</name>
                                <host>Template pve api qemu</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>0</x>
                            <y>2</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>1</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>1</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>20</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>{#PVEQEMUBLOCKDEV} read/write</name>
                                <host>Template pve api qemu</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>1</x>
                            <y>2</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>1</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>1</max_columns>
                        </screen_item>
                        <screen_item>
                            <resourcetype>20</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>{#PVEQEMUBLOCKDEV} iops</name>
                                <host>Template pve api qemu</host>
                            </resource>
                            <width>500</width>
                            <height>100</height>
                            <x>2</x>
                            <y>2</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>0</elements>
                            <valign>1</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>1</max_columns>
                        </screen_item>
                    </screen_items>
                </screen>
            </screens>
        </template>
        <template>
            <template>Template pve api settings</template>
            <name>Template pve api settings</name>
            <description>This template only contains configuration macro's with default values.</description>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <macros>
                <macro>
                    <macro>{$PVEAPITIMEOUT}</macro>
                    <value>2m</value>
                    <description>Alert if api is unreachable for this long</description>
                </macro>
                <macro>
                    <macro>{$PVELOCKTIME}</macro>
                    <value>2h</value>
                    <description>Alert if lxc or qemu is locked for this long</description>
                </macro>
                <macro>
                    <macro>{$PVEMEMLOWWATER}</macro>
                    <value>80</value>
                    <description>Revovery percentage of free memory</description>
                </macro>
                <macro>
                    <macro>{$PVESNAPSHOTAGE}</macro>
                    <value>4w</value>
                    <description>Alert if snapshots older than 1 week (default)</description>
                </macro>
                <macro>
                    <macro>{$PVESNAPSHOTEXCLUDE}</macro>
                    <value>after_clean</value>
                    <description>Ignore snapshots starting with this text</description>
                </macro>
                <macro>
                    <macro>{$PVETESTPOOL}</macro>
                    <value>(test|disabled|maintenance)</value>
                    <description>Systems in this pool will not generate triggers</description>
                </macro>
            </macros>
        </template>
    </templates>
    <triggers>
        <trigger>
            <expression>{Template pve api lxc:pveapi.lxc.cpu.avg(15m)}&gt;80 and {Template pve api lxc:pveapi.lxc.poolcheck.last()}=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>{Template pve api lxc:pveapi.lxc.cpu.avg(15m)}&lt;70</recovery_expression>
            <name>CPU over 80% for last 15 minutes on {$PVELXCNAME}</name>
            <priority>WARNING</priority>
            <description>{$PVELXCNAME} has more then 80% CPU usage over the last 15 minutes</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>({Template pve api node:pveapi.node.cpu.user.avg(15m)} + {Template pve api node:pveapi.node.cpu.wait.avg(15m)}) &gt; 80</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>({Template pve api node:pveapi.node.cpu.user.avg(15m)} + {Template pve api node:pveapi.node.cpu.wait.avg(15m)}) &lt; 70</recovery_expression>
            <name>CPU over 80% for last 15 minutes on {$PVENODE}</name>
            <priority>WARNING</priority>
            <description>{$PVENODE} has more then 80% CPU usage over the last 15 minutes</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>{Template pve api qemu:pveapi.qemu.cpu.avg(15m)}&gt;80 and {Template pve api qemu:pveapi.qemu.poolcheck.last()}=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>{Template pve api qemu:pveapi.qemu.cpu.avg(15m)}&lt;70</recovery_expression>
            <name>CPU over 80% for last 15 minutes on {$PVEQEMUNAME}</name>
            <priority>WARNING</priority>
            <description>{$PVEQEMUNAME} has more then 80% CPU usage over the last 15 minutes</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>{Template pve api lxc:pveapi.lxc.diskfree.avg(10m)}&lt;1 and {Template pve api lxc:pveapi.lxc.poolcheck.last()}=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>{Template pve api lxc:pveapi.lxc.diskfree.avg(10m)}&gt;3</recovery_expression>
            <name>Disk full on {$PVELXCNAME}</name>
            <priority>DISASTER</priority>
            <description>{$PVELXCNAME} has no diskspace left over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>{Template pve api lxc:pveapi.lxc.diskfree.avg(10m)}&lt;5 and {Template pve api lxc:pveapi.lxc.poolcheck.last()}=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>{Template pve api lxc:pveapi.lxc.diskfree.avg(10m)}&gt;7</recovery_expression>
            <name>Disk less than 5% free on {$PVELXCNAME}</name>
            <priority>HIGH</priority>
            <description>{$PVELXCNAME} has less then 5% diskspace free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>{Template pve api lxc:pveapi.lxc.diskfree.avg(10m)}&lt;10 and&#13;
{Template pve api lxc:pveapi.lxc.diskfree.avg(10m)}&gt;5 and {Template pve api lxc:pveapi.lxc.poolcheck.last()}=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>{Template pve api lxc:pveapi.lxc.diskfree.avg(10m)}&gt;15</recovery_expression>
            <name>Disk less than 10% free on {$PVELXCNAME}</name>
            <priority>WARNING</priority>
            <description>{$PVELXCNAME} has less then 10% diskspace free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>{Template pve api lxc:pveapi.lxc.memfree.avg(10m)}&lt;5 and {Template pve api lxc:pveapi.lxc.poolcheck.last()}=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>{Template pve api lxc:pveapi.lxc.memfree.avg(10m)}&gt;10</recovery_expression>
            <name>Memory less than 5% free on {$PVELXCNAME}</name>
            <priority>WARNING</priority>
            <description>{$PVELXCNAME} has less then 5% memory + swap free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>(100*({Template pve api node:pveapi.node.mem.used.avg(10m)}/{Template pve api node:pveapi.node.mem.total.avg(10m)})) &gt; 95</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>(100*({Template pve api node:pveapi.node.mem.used.avg(10m)}/{Template pve api node:pveapi.node.mem.total.avg(10m)})) &lt; {$PVEMEMLOWWATER}</recovery_expression>
            <name>Memory less than 5% free on {$PVENODE}</name>
            <priority>WARNING</priority>
            <description>{$PVENODE} has less then 5% memory + swap free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>(100* ({Template pve api node:pveapi.node.rootfs.used.avg(10m)} / {Template pve api node:pveapi.node.rootfs.total.avg(10m)})) &gt; 90</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>(100* ({Template pve api node:pveapi.node.rootfs.used.avg(10m)} / {Template pve api node:pveapi.node.rootfs.total.avg(10m)})) &lt; 80</recovery_expression>
            <name>RootFS has less than 10% free on {$PVENODE}</name>
            <priority>WARNING</priority>
            <description>{$PVENODE} has less then 10% diskspace free over the last 10 minutes</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>(100*({Template pve api node:pveapi.node.swap.used.avg(10m)}/{Template pve api node:pveapi.node.swap.total.avg(10m)})) &gt; 50</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>(100*({Template pve api node:pveapi.node.swap.used.avg(10m)}/{Template pve api node:pveapi.node.swap.total.avg(10m)})) &lt; 40</recovery_expression>
            <name>Swap more than 50% used on {$PVENODE}</name>
            <priority>WARNING</priority>
            <description>{$PVENODE} has less then 5% memory + swap free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>({Template pve api lxc:pveapi.lxc.lock.count({$PVELOCKTIME})} =  {Template pve api lxc:pveapi.lxc.lock.count({$PVELOCKTIME},&quot;&quot;,ne)}) and {Template pve api lxc:pveapi.lxc.poolcheck.last()}=1</expression>
            <name>{$PVELXCNAME} is locked: {ITEM.LASTVALUE1}</name>
            <priority>AVERAGE</priority>
            <description>{$PVELXCNAME} is stopped.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>{Template pve api lxc:pveapi.lxc.uptime.change(0)}&lt;0 and {Template pve api lxc:pveapi.lxc.status.regexp(running)}=1 and {Template pve api lxc:pveapi.lxc.poolcheck.last()}=1</expression>
            <name>{$PVELXCNAME} is restarted</name>
            <priority>INFO</priority>
            <description>{$PVELXCNAME} restarted</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>{Template pve api lxc:pveapi.lxc.status.regexp(stopped)}=1 and {Template pve api lxc:pveapi.lxc.poolcheck.last()}=1</expression>
            <name>{$PVELXCNAME} is stopped</name>
            <priority>WARNING</priority>
            <description>{$PVELXCNAME} is stopped.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>{Template pve api qemu:pveapi.qemu.uptime.change(0)}&lt;0 and {Template pve api qemu:pveapi.qemu.poolcheck.last()}=1</expression>
            <name>{$PVEQEMUNAME} is restarted</name>
            <priority>INFO</priority>
            <description>{$PVEQEMUNAME} restarted</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>{Template pve api qemu:pveapi.qemu.status.regexp(stopped)}=1 and {Template pve api qemu:pveapi.qemu.poolcheck.last()}=1</expression>
            <name>{$PVEQEMUNAME} is stopped</name>
            <priority>WARNING</priority>
            <description>{$PVEQEMUNAME} is stopped.</description>
            <manual_close>YES</manual_close>
        </trigger>
    </triggers>
    <graphs>
        <graph>
            <name>Cluster status</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api datacenter</host>
                <key>pveapi.datacenter.clusternodes</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api datacenter</host>
                        <key>pveapi.datacenter.clusternodesonline</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>CPU</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>FIXED</ymax_type_1>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.cpu</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>CPU ({{HOST.HOST}:pveapi.node.cpus.last(0)} CPU(s))</name>
            <type>STACKED</type>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>FIXED</ymax_type_1>
            <graph_items>
                <graph_item>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.cpu.wait</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>FFBF00</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.cpu.user</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>CPU ({{HOST.HOST}:pveapi.qemu.cpus.last(0)} CPU(s))</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>FIXED</ymax_type_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api qemu</host>
                        <key>pveapi.qemu.cpu</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Disk IO</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.diskread</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.diskwrite</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Disk usage</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api lxc</host>
                <key>pveapi.lxc.maxdisk</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>33FF33</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.maxdisk</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.disk</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>KSM</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.ksm</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Load average</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.load</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Memory ({{HOST.HOST}:pveapi.node.mem.total.last(0)})</name>
            <type>STACKED</type>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api node</host>
                <key>pveapi.node.mem.total</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.mem.used</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Memory usage</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api lxc</host>
                <key>pveapi.lxc.maxmem</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>33FF33</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.maxmem</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.mem</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Memory usage</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api qemu</host>
                <key>pveapi.qemu.maxmem</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>33FF33</color>
                    <item>
                        <host>Template pve api qemu</host>
                        <key>pveapi.qemu.maxmem</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api qemu</host>
                        <key>pveapi.qemu.mem</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Network traffic</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.netin</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.netout</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Root filesystem ({{HOST.HOST}:pveapi.node.rootfs.total.last(0)})</name>
            <show_triggers>NO</show_triggers>
            <type>STACKED</type>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api node</host>
                <key>pveapi.node.rootfs.total</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.rootfs.used</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Swap ({{HOST.HOST}:pveapi.node.swap.total.last(0)})</name>
            <type>STACKED</type>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api node</host>
                <key>pveapi.node.swap.total</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.swap.used</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Swap usage</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api lxc</host>
                <key>pveapi.lxc.maxswap</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>33FF33</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.maxswap</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.swap</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Uptime</name>
            <show_work_period>NO</show_work_period>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.uptime</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Uptime</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.uptime</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Uptime</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api qemu</host>
                        <key>pveapi.qemu.uptime</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
</zabbix_export>
