<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.4</version>
    <template_groups>
        <template_group>
            <uuid>756d97bb256b458094d71ee0c547804e</uuid>
            <name>Production</name>
        </template_group>
        <template_group>
            <uuid>7df96b18c230490a9a0a9e2307226338</uuid>
            <name>Templates</name>
        </template_group>
    </template_groups>
    <host_groups>
        <host_group>
            <uuid>6771a206416040f98e9c7059885e982e</uuid>
            <name>PVE LXC</name>
        </host_group>
        <host_group>
            <uuid>3cdd708e74354c74af5de0d69635648b</uuid>
            <name>PVE Node</name>
        </host_group>
        <host_group>
            <uuid>36d5230d3b8e40f2a4c4eeb35f9d74c1</uuid>
            <name>PVE Qemu</name>
        </host_group>
    </host_groups>
    <templates>
        <template>
            <uuid>8b735b851b6a4174a12f8ec4add50d47</uuid>
            <template>Template pve api datacenter</template>
            <name>Template pve api datacenter</name>
            <description>This template monitors a Proxmox system. It requires access to port 8006 either from the zabbix server or from a zabbix proxy. It will not work through a zabbix agent.
The template requires a Proxmox API key for access to the Proxmox API. The values should be set in the following macro's:
{$PVESERVER} : Server to talk to for the API
{$PVETOKENID} : API token ID
{$PVESECRET} : API secret</description>
            <templates>
                <template>
                    <name>Template pve api settings</name>
                </template>
            </templates>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>ff57547ef91049cc9b51d9ba88ec500a</uuid>
                    <name>Cluster nodes</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.clusternodes</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.type == &quot;node&quot;)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Datacenter</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>2718953ca7ce4e069fe1fa935ad294a6</uuid>
                    <name>Cluster nodes online</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.clusternodesonline</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.type == &quot;node&quot; &amp;&amp; @.status == &quot;online&quot;)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Datacenter</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>de6e90004cbb4401889275608d2c1d7a</uuid>
                    <name>pveapi datacenter master resources</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.datacenter.master.resources</key>
                    <delay>10m</delay>
                    <history>1h</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <description>Item specifically does not use cluster/config/nodes as that has no information for single node systems.</description>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/cluster/resources</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Datacenter</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>db5709857e994f9e85376cec7ae1b281</uuid>
                            <expression>nodata(/Template pve api datacenter/pveapi.datacenter.master.resources,20m)=1</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>nodata(/Template pve api datacenter/pveapi.datacenter.master.resources,2m)=0</recovery_expression>
                            <name>{$PVESERVER} Proxmox API unreachable</name>
                            <priority>DISASTER</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>0ce78178593843ab9e4154d4508f6f25</uuid>
                    <name>pveapi datacenter master tasks</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.datacenter.master.tasks</key>
                    <delay>2m</delay>
                    <history>1h</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/cluster/tasks</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Datacenter</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>50472fc2be7249b782cd1017d19eeb2e</uuid>
                    <name>Tasks failed</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.tasks.failed</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>var data = JSON.parse(value);
const curtime = Math.round(Date.now() / 1000)

for (x in data.body.data) {
   if ('starttime' in data.body.data[x])
      data.body.data[x].starttime = curtime - data.body.data[x].starttime;
   if ('endtime' in data.body.data[x])
      data.body.data[x].endtime = curtime - data.body.data[x].endtime;
}

return JSON.stringify(data);</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.starttime &lt; &quot;{$PVETASKTIME}&quot; &amp;&amp; @.endtime &amp;&amp; @.status != &quot;OK&quot; &amp;&amp; @.status != &quot;Failed to run vncproxy.&quot;)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.datacenter.master.tasks</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <uuid>462bb47210904e90b98edcbca6f66973</uuid>
                            <expression>last(/Template pve api datacenter/pveapi.datacenter.tasks.failed,#1) &gt; 0</expression>
                            <name>{$PVESERVER} tasks failed</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>188374de2473498c9345f006d374e32b</uuid>
                    <name>Tasks running</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.tasks.running</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(!@.endtime)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.datacenter.master.tasks</key>
                    </master_item>
                </item>
                <item>
                    <uuid>0399381bb22e49008af92918f68005ae</uuid>
                    <name>Tasks total</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.tasks.total</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[*].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.datacenter.master.tasks</key>
                    </master_item>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>2ee43a8e88fb44ada00aea58a3f68c77</uuid>
                    <name>pveapi datacenter discovery lxc</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.discovery.lxc</key>
                    <delay>0</delay>
                    <lifetime>5d</lifetime>
                    <host_prototypes>
                        <host_prototype>
                            <uuid>018549507b8045619f16f8aeae4c9dc4</uuid>
                            <host>lxc {#PVELXCNAME}</host>
                            <name>{#PVELXCNAME} (on {#PVENODE})</name>
                            <group_links>
                                <group_link>
                                    <group>
                                        <name>PVE LXC</name>
                                    </group>
                                </group_link>
                            </group_links>
                            <group_prototypes>
                                <group_prototype>
                                    <name>{#PVENODE} (lxc)</name>
                                </group_prototype>
                            </group_prototypes>
                            <templates>
                                <template>
                                    <name>Template pve api lxc</name>
                                </template>
                            </templates>
                            <macros>
                                <macro>
                                    <macro>{$PVELXCID}</macro>
                                    <value>{#PVELXCID}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVELXCNAME}</macro>
                                    <value>{#PVELXCNAME}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVELXCPOOL}</macro>
                                    <value>{#PVELXCPOOL}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVENODE}</macro>
                                    <value>{#PVENODE}</value>
                                </macro>
                            </macros>
                        </host_prototype>
                    </host_prototypes>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVELXCID}</lld_macro>
                            <path>$.vmid</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVELXCNAME}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVELXCPOOL}</lld_macro>
                            <path>$.pool</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVENODE}</lld_macro>
                            <path>$.node</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.type == &quot;lxc&quot;)]</parameter>
                            </parameters>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>46e03e45a837433aad3a980cdebe1de6</uuid>
                    <name>pveapi datacenter discovery node</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.discovery.node</key>
                    <delay>0</delay>
                    <lifetime>10d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>d1187755de3744eeaccb702a74c18bac</uuid>
                            <name>Node {#PVENODE} online</name>
                            <type>DEPENDENT</type>
                            <key>pxeapi.datacenter.node.online[{#PVENODE}]</key>
                            <delay>0</delay>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data[?(@.node== &quot;{#PVENODE}&quot; &amp;&amp; @.status == &quot;online&quot;)].status.length()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.datacenter.master.resources</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Datacenter</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>142fe8a88c8d489abafdac7504bf9b16</uuid>
                                    <expression>last(/Template pve api datacenter/pxeapi.datacenter.node.online[{#PVENODE}])=0</expression>
                                    <name>Node {#PVENODE} offline</name>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <host_prototypes>
                        <host_prototype>
                            <uuid>1c311b8889e248cd8e3509b158b9b58e</uuid>
                            <host>node {#PVENODE}</host>
                            <name>{#PVENODE}</name>
                            <group_links>
                                <group_link>
                                    <group>
                                        <name>PVE Node</name>
                                    </group>
                                </group_link>
                            </group_links>
                            <templates>
                                <template>
                                    <name>Template pve api node</name>
                                </template>
                            </templates>
                            <macros>
                                <macro>
                                    <macro>{$PVENODE}</macro>
                                    <value>{#PVENODE}</value>
                                </macro>
                            </macros>
                        </host_prototype>
                    </host_prototypes>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODE}</lld_macro>
                            <path>$.node</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.type == &quot;node&quot;)]</parameter>
                            </parameters>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>dfb983681b4543868377640b801cd452</uuid>
                    <name>pveapi datacenter discovery qemu</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.datacenter.discovery.qemu</key>
                    <delay>0</delay>
                    <lifetime>5d</lifetime>
                    <host_prototypes>
                        <host_prototype>
                            <uuid>f670c3641b644ad6a00eb1498743a1c5</uuid>
                            <host>qemu {#PVEQEMUNAME}</host>
                            <name>{#PVEQEMUNAME} (on {#PVENODE})</name>
                            <group_links>
                                <group_link>
                                    <group>
                                        <name>PVE Qemu</name>
                                    </group>
                                </group_link>
                            </group_links>
                            <group_prototypes>
                                <group_prototype>
                                    <name>{#PVENODE} (qemu)</name>
                                </group_prototype>
                            </group_prototypes>
                            <templates>
                                <template>
                                    <name>Template pve api qemu</name>
                                </template>
                            </templates>
                            <macros>
                                <macro>
                                    <macro>{$PVENODE}</macro>
                                    <value>{#PVENODE}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVEQEMUID}</macro>
                                    <value>{#PVEQEMUID}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVEQEMUNAME}</macro>
                                    <value>{#PVEQEMUNAME}</value>
                                </macro>
                                <macro>
                                    <macro>{$PVEQEMUPOOL}</macro>
                                    <value>{#PVEQEMUPOOL}</value>
                                </macro>
                            </macros>
                        </host_prototype>
                    </host_prototypes>
                    <master_item>
                        <key>pveapi.datacenter.master.resources</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODE}</lld_macro>
                            <path>$.node</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUID}</lld_macro>
                            <path>$.vmid</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUNAME}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUPOOL}</lld_macro>
                            <path>$.pool</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.type == &quot;qemu&quot;)]</parameter>
                            </parameters>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <dashboards>
                <dashboard>
                    <uuid>1b8431cf88d64f95abda9b544ec61d40</uuid>
                    <name>Cluster status</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>graph</type>
                                    <width>24</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api datacenter</host>
                                                <name>Cluster status</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
            </dashboards>
        </template>
        <template>
            <uuid>975578387988488bb324a44bcffd6292</uuid>
            <template>Template pve api lxc</template>
            <name>Template pve api lxc</name>
            <description>This template is used by Template pve api datacenter. Please don't use directly.</description>
            <templates>
                <template>
                    <name>Template pve api settings</name>
                </template>
            </templates>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>00ec725b01924ad7b67938c7cd1953d7</uuid>
                    <name>CPU</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.cpu</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.cpu</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>100</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>9b4a097417274609ba330e21e8a37b6d</uuid>
                    <name>CPUs</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.cpus</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.cpus</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>03f17c29fb0b479ca100d48396bf404b</uuid>
                    <name>Disk used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.disk</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.disk</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>7346b33c66114725a705a3653aac6e3f</uuid>
                    <name>Disk free</name>
                    <type>CALCULATED</type>
                    <key>pveapi.lxc.diskfree</key>
                    <units>%</units>
                    <params>100*(last(//pveapi.lxc.maxdisk) - last(//pveapi.lxc.disk)) / last(//pveapi.lxc.maxdisk)</params>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>97f0a79c3fa6402a8a90d37cb558301e</uuid>
                    <name>Disk read</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.diskread</key>
                    <delay>0</delay>
                    <units>Bps</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.diskread</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>25d9e7a758394b65a5b0d0f185aa8b27</uuid>
                    <name>Disk write</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.diskwrite</key>
                    <delay>0</delay>
                    <units>Bps</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.diskwrite</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>55050e46f227422289ba90cb8d8e9f82</uuid>
                    <name>Lock</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.lock</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.lock</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>d8c58fd8185d4423a73ef52b5f1958e9</uuid>
                    <name>pveapi lxc master snapshot</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.lxc.master.snapshot</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/lxc/{$PVELXCID}/snapshot</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <allow_traps>YES</allow_traps>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>f18c30dd8bb4467abfb92d2ac9f119c9</uuid>
                    <name>pveapi lxc master status</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.lxc.master.status</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/lxc/{$PVELXCID}/status/current</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>33c454b03fb84e0ba213d4e7ccc122c1</uuid>
                    <name>Disk size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.maxdisk</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.maxdisk</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>104c33822b6f472ebe7f0497ea80d8cb</uuid>
                    <name>Memory size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.maxmem</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.maxmem</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>7158e1a05db54d889166c8aa9355d0ff</uuid>
                    <name>Swap size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.maxswap</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.maxswap</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>27169e31f94e4d328c8367faad9fbab8</uuid>
                    <name>Memory used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.mem</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.mem</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>116cf567723e40f884406e30bbb9504a</uuid>
                    <name>Memory free</name>
                    <type>CALCULATED</type>
                    <key>pveapi.lxc.memfree</key>
                    <units>%</units>
                    <params>100*(((last(//pveapi.lxc.maxmem)+last(//pveapi.lxc.maxswap)) - (last(//pveapi.lxc.mem)+last(//pveapi.lxc.swap))) / (last(//pveapi.lxc.maxmem)+last(//pveapi.lxc.maxswap)))</params>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>bc1eb7f680c5453e95a6b8b7fc14a665</uuid>
                    <name>Net in</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.netin</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.netin</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>9c40a6bd0d8b4f148aec53f4b0a71040</uuid>
                    <name>Net out</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.netout</key>
                    <delay>0</delay>
                    <units>bps</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.netout</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>8</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>752630c9ebe54208978b190238063c7f</uuid>
                    <name>Pool check</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.lxc.poolcheck</key>
                    <delay>15m</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.poolid==&quot;{$PVELXCPOOL}&quot;)].poolid.first()</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>__</error_handler_params>
                        </step>
                        <step>
                            <type>MATCHES_REGEX</type>
                            <parameters>
                                <parameter>{$PVENOPROBLEMPOOL}</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>1</error_handler_params>
                        </step>
                        <step>
                            <type>IN_RANGE</type>
                            <parameters>
                                <parameter>1</parameter>
                                <parameter>2</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>0</error_handler_params>
                        </step>
                    </preprocessing>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/pools</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e6f784d27f924e7cba9010d91742d20a</uuid>
                    <name>Status</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.status</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.status</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e80223be14534eaea97b4d621c04a9df</uuid>
                    <name>Swap used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.swap</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.swap</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>bcd4d2ff19b14047be3c1a734ff0a66e</uuid>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.uptime</key>
                    <delay>0</delay>
                    <units>uptime</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.uptime</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.lxc.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE LXC</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>9f26aac459f04599ac3d152074fc5809</uuid>
                    <name>pveapi lxc discovery snapshot</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.lxc.snapshot.discovery</key>
                    <delay>0</delay>
                    <lifetime>1h</lifetime>
                    <description>Discover snapshots for lxc.</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>b116819a855547cb98d147ab37e271f4</uuid>
                            <name>Snapshot {#PVELXCSNAPSHOT} check</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.lxc.snapshot.check[{#PVELXCSNAPSHOT}]</key>
                            <delay>0</delay>
                            <history>1h</history>
                            <trends>0</trends>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data[?(@.name==&quot;{#PVELXCSNAPSHOT}&quot; &amp;&amp; ! (@.name =~ &quot;^{$PVESNAPSHOTEXCLUDE}&quot;))].length()</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.lxc.master.snapshot</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE LXC</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>d2305595e07e413baca36fb1a17dd0cb</uuid>
                            <name>Snapshot {#PVELXCSNAPSHOT} create time</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.lxc.snapshot.time[{#PVELXCSNAPSHOT}]</key>
                            <delay>0</delay>
                            <history>1h</history>
                            <trends>0</trends>
                            <units>unixtime</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data[?(@.name==&quot;{#PVELXCSNAPSHOT}&quot;)].snaptime.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.lxc.master.snapshot</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE LXC</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>dea17456f41f4600b746590999a1e113</uuid>
                            <expression>now()-
last(/Template pve api lxc/pveapi.lxc.snapshot.time[{#PVELXCSNAPSHOT}])&gt;{$PVESNAPSHOTAGE} and last(/Template pve api lxc/pveapi.lxc.snapshot.check[{#PVELXCSNAPSHOT}])=1</expression>
                            <name>{$PVELXCNAME} snapshot {#PVELXCSNAPSHOT} too old</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <master_item>
                        <key>pveapi.lxc.master.snapshot</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVELXCSNAPSHOT}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.name!=&quot;current&quot;)]</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>{ &quot;data&quot;:[] }</error_handler_params>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <dashboards>
                <dashboard>
                    <uuid>01eed1ba71b94af79c18b2a258f678ee</uuid>
                    <name>LXC overview</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>plaintext</type>
                                    <width>12</width>
                                    <fields>
                                        <field>
                                            <type>ITEM</type>
                                            <name>itemids</name>
                                            <value>
                                                <host>Template pve api lxc</host>
                                                <key>pveapi.lxc.status</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show_lines</name>
                                            <value>1</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <y>2</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api lxc</host>
                                                <name>CPU</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <y>7</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api lxc</host>
                                                <name>Memory usage</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <y>12</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api lxc</host>
                                                <name>Disk usage</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <x>12</x>
                                    <y>2</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api lxc</host>
                                                <name>Uptime</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <x>12</x>
                                    <y>7</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api lxc</host>
                                                <name>Swap usage</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <x>12</x>
                                    <y>12</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api lxc</host>
                                                <name>Network traffic</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
            </dashboards>
        </template>
        <template>
            <uuid>cc75782a05464ff893b58e7f4539b0f7</uuid>
            <template>Template pve api node</template>
            <name>Template pve api node</name>
            <description>This template is used by Template pve api datacenter. Please don't use directly.</description>
            <templates>
                <template>
                    <name>Template pve api settings</name>
                </template>
            </templates>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>580894e9044c404f80829df7f44a481b</uuid>
                    <name>CPU user</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.cpu.user</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.cpu</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>100</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5c9784510bce4f759d2ccb3f93be0154</uuid>
                    <name>CPU wait</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.cpu.wait</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.wait</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>100</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>20a702998e954b08ae4f021000a38451</uuid>
                    <name>CPUs</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.cpus</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.cpuinfo.cpus</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>76146ef896c94bdb8aa44badeb0db31d</uuid>
                    <name>Kernel version</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.kernelversion</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.kversion</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>467025c09e474347bcfcd6e9ee01fa2f</uuid>
                    <name>KSM</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.ksm</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.ksm.shared</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>daeb9c10aad54404bf3807a7820908bd</uuid>
                    <name>Load average</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.load</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.loadavg[0]</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>bb7773418733474cb39973903cc52bab</uuid>
                    <name>pveapi node master status</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/status</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>95dac351045341e9aa7225aa1b568e84</uuid>
                    <name>pveapi node master disks</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.disks</key>
                    <delay>1h</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/disks/list</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>337239c046da45cfb3e321c7cda7e228</uuid>
                    <name>pveapi node master lvm</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.lvm</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/disks/lvm</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>07a31ac6e8bf45bfb40b6ea3364e3eca</uuid>
                    <name>pveapi node master lvmthin</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.lvmthin</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/disks/lvmthin</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>805a56d0402b41ba9cb3b7104c595a0f</uuid>
                    <name>pveapi node master services</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.services</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/services</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>2344fa360da241df8e437bffba736077</uuid>
                    <name>pveapi node master storagepools</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.storagepools</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>NOT_MATCHES_REGEX</type>
                            <parameters>
                                <parameter>^$</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>[]</error_handler_params>
                        </step>
                    </preprocessing>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/storage</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>98ee8e669ae347efb1d84f753d1a7b5b</uuid>
                    <name>pveapi node master zfs</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.node.master.zfs</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/disks/zfs</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>2fdbbd54d77e449d9fb5b8ab6652f5b3</uuid>
                    <name>Memory size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.mem.total</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.memory.total</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>66ef9aaaa00b4fccb7bbff68d43453a4</uuid>
                    <name>Memory used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.mem.used</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.memory.used</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>2e5e1308fc86472cbe1d3aae8e7f8108</uuid>
                    <name>PVE version</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.pveversion</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.pveversion</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>7b361dbc7843401cb0ee469d35b72880</uuid>
                    <name>Root filesystem size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.rootfs.total</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.rootfs.total</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>484a9d3d696c4837b6f77550dca78b73</uuid>
                    <name>Root filesystem used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.rootfs.used</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.rootfs.used</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>fccedaf7c07e4be2bc51256372384bee</uuid>
                    <name>Swap size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.swap.total</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.swap.total</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>bfe34929de9040caae820385ee6c24e0</uuid>
                    <name>Swap used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.swap.used</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.swap.used</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>078b80c30ec54ef68b97a21f584764da</uuid>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.uptime</key>
                    <delay>0</delay>
                    <units>uptime</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.uptime</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.node.master</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Node</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>6d85ac93491f4a0daa32b2a0c91984b1</uuid>
                            <expression>change(/Template pve api node/pveapi.node.uptime)&lt;0</expression>
                            <name>{$PVENODE} is restarted</name>
                            <priority>INFO</priority>
                            <description>{$PVENODE} restarted</description>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>8c44b51adeef43088d22d4394619251c</uuid>
                    <name>pveapi node discovery disks</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.disks</key>
                    <delay>0</delay>
                    <lifetime>5d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>376fe3ffdb5542e19b661463cf29c9d2</uuid>
                            <name>Disk {#PVENODEDISK} health</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.disk.health[{#PVENODEDISK}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data[?(@.devpath==&quot;{#PVENODEDISK}&quot;)].health.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.disks</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>bc24d66114454e9ebf9e9fc0c8ba7549</uuid>
                                    <expression>find(/Template pve api node/pveapi.node.disk.health[{#PVENODEDISK}],,&quot;regexp&quot;,&quot;PASSED|OK|UNKNOWN&quot;)=0</expression>
                                    <name>{$PVENODE} disk {#PVENODEDISK} health failed</name>
                                    <priority>DISASTER</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>37068cdd6d8049aab2db19987b221c8e</uuid>
                            <name>Disk {#PVENODEDISK} wearout</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.disk.wearout[{#PVENODEDISK}]</key>
                            <delay>0</delay>
                            <units>%</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data[?(@.devpath==&quot;{#PVENODEDISK}&quot;)].wearout.first()</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>NOT_MATCHES_REGEX</type>
                                    <parameters>
                                        <parameter>N/A</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>100</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.disks</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>9c88aa4c079e451484c45736302f068f</uuid>
                                    <expression>last(/Template pve api node/pveapi.node.disk.wearout[{#PVENODEDISK}])&lt;-10</expression>
                                    <name>{$PVENODE} disk {#PVENODEDISK} wearout under 10%</name>
                                    <priority>HIGH</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <uuid>b351159990db43e8a163d64673d0c271</uuid>
                                    <expression>last(/Template pve api node/pveapi.node.disk.wearout[{#PVENODEDISK}])&lt;=20</expression>
                                    <name>{$PVENODE} disk {#PVENODEDISK} wearout under 20%</name>
                                    <priority>AVERAGE</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>9009a1cd68b14ed1b5da495f7cf2d39e</uuid>
                            <name>Disk wearout ({?last(//pveapi.node.disk.health[{#PVENODEDISK}])})</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>FIXED</ymax_type_1>
                            <graph_items>
                                <graph_item>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.disk.wearout[{#PVENODEDISK}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.node.master.disks</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODEDISK}</lld_macro>
                            <path>$.devpath</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>[]</error_handler_params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>fa0c9b682e72493e8673826fd439c9b0</uuid>
                    <name>pveapi node discovery lvm</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.lvm</key>
                    <delay>0</delay>
                    <lifetime>5d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>c7761e7882814dc39c72e0d9c071f75c</uuid>
                            <name>LVM {#PVENODELVM} free</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvm.free[{#PVENODELVM}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.children.[?(@.name==&quot;{#PVENODELVM}&quot;)].free.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvm</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>30c035eee7a741d6832e90bd9101fcc9</uuid>
                            <name>LVM {#PVENODELVM} size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvm.size[{#PVENODELVM}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.children.[?(@.name==&quot;{#PVENODELVM}&quot;)].size.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvm</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>adeb4e86ec25400ba407f7d2ddb7c4fa</uuid>
                            <name>LVM {#PVENODELVM} used</name>
                            <type>CALCULATED</type>
                            <key>pveapi.node.lvm.used[{#PVENODELVM}]</key>
                            <units>B</units>
                            <params>last(//pveapi.node.lvm.size[{#PVENODELVM}]) - last(//pveapi.node.lvm.free[{#PVENODELVM}])</params>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>5938077c29974596afb318a01f136d59</uuid>
                            <name>LVM {#PVENODELVM} used</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>Template pve api node</host>
                                <key>pveapi.node.lvm.size[{#PVENODELVM}]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.lvm.used[{#PVENODELVM}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.node.master.lvm</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODELVM}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.children</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>[]</error_handler_params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>d15ecd14900f4423a2e7d1f06aefbf25</uuid>
                    <name>pveapi node discovery lvmthin</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.lvmthin</key>
                    <delay>0</delay>
                    <lifetime>5d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>44dee8a28f7643bb85f0cc209e1fa9a5</uuid>
                            <name>LVMThin {#PVENODELVMTHIN} metadata size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.lv==&quot;{#PVENODELVMTHIN}&quot;)].metadata_size.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvmthin</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>d7211f39624f4fb8a9a22e0bc277d1aa</uuid>
                            <name>LVMThin {#PVENODELVMTHIN} metadata used</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.lv==&quot;{#PVENODELVMTHIN}&quot;)].metadata_used.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvmthin</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>d746fd4ce5624e32b747d0a1f92262ec</uuid>
                            <name>LVMThin {#PVENODELVMTHIN} size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvmthin.size[{#PVENODELVMTHIN}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.lv==&quot;{#PVENODELVMTHIN}&quot;)].lv_size.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvmthin</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>0cdd92bedcb14fd39befd1b7c04c0ced</uuid>
                            <name>LVMThin {#PVENODELVMTHIN} used</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.lvmthin.used[{#PVENODELVMTHIN}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.lv==&quot;{#PVENODELVMTHIN}&quot;)].used.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.lvmthin</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>664ca8bb53604ea1bcc39c7a4e583edb</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}])))
&gt; 98</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}])))
&lt; 95</recovery_expression>
                            <name>{$PVENODE} lvm thin metadata {#PVENODELVMTHIN} less then 2% free</name>
                            <priority>DISASTER</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>9030bda7c5a549229e2a82207c434268</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}])))
&gt; 90</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}]))) &lt; 88</recovery_expression>
                            <name>{$PVENODE} lvm thin metadata {#PVENODELVMTHIN} less then 10% free</name>
                            <priority>HIGH</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>c56349f1242849de854389685e65100a</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}])))
&gt; 80</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}])))
&lt; 75</recovery_expression>
                            <name>{$PVENODE} lvm thin metadata {#PVENODELVMTHIN} less then 20% free</name>
                            <priority>WARNING</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>0ebf3fe825a94067a292846104bdabcd</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.used[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.size[{#PVENODELVMTHIN}])))
&gt; 98</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.used[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.size[{#PVENODELVMTHIN}])))
&lt; 95</recovery_expression>
                            <name>{$PVENODE} lvm thin {#PVENODELVMTHIN} less then 2% free</name>
                            <priority>DISASTER</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>f6612447d5eb4a649316622af57081c4</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.used[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.size[{#PVENODELVMTHIN}])))
&gt; 90</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.used[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.size[{#PVENODELVMTHIN}])))
&lt; 88</recovery_expression>
                            <name>{$PVENODE} lvm thin {#PVENODELVMTHIN} less then 10% free</name>
                            <priority>HIGH</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>b79b31ad77f94549a32cd31dbce53c4a</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.used[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.size[{#PVENODELVMTHIN}])))
&gt; 80</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.lvmthin.used[{#PVENODELVMTHIN}])/
last(/Template pve api node/pveapi.node.lvmthin.size[{#PVENODELVMTHIN}])))
&lt; 75</recovery_expression>
                            <name>{$PVENODE} lvm thin {#PVENODELVMTHIN} less then 20% free</name>
                            <priority>WARNING</priority>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>861ed4c6d98645fe8dc2ffc341f8c43f</uuid>
                            <name>LVMThin {#PVENODELVMTHIN} metadata usage</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>Template pve api node</host>
                                <key>pveapi.node.lvmthin.metadatasize[{#PVENODELVMTHIN}]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.lvmthin.metadataused[{#PVENODELVMTHIN}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>839179c33cc448e0b0522b1709006fcc</uuid>
                            <name>LVMThin {#PVENODELVMTHIN} usage</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>Template pve api node</host>
                                <key>pveapi.node.lvmthin.size[{#PVENODELVMTHIN}]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.lvmthin.used[{#PVENODELVMTHIN}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.node.master.lvmthin</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODELVMTHIN}</lld_macro>
                            <path>$.lv</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>[]</error_handler_params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>8882d95fcc1a45d3a2401bac7784d3c0</uuid>
                    <name>pveapi node discovery services</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.services</key>
                    <delay>0</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#PVENODESERVICEUNITSTATE}</macro>
                                <value>^not-found$</value>
                                <operator>NOT_MATCHES_REGEX</operator>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>5d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>c6c7d3ff89c94965b02f8c1a94e2a811</uuid>
                            <name>service {#PVENODESERVICE}</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.services.state[{#PVENODESERVICE}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.name==&quot;{#PVENODESERVICE}&quot;)].state.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.services</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>de30c6b9c3c8452a93523b79e14eb657</uuid>
                                    <expression>find(/Template pve api node/pveapi.node.services.state[{#PVENODESERVICE}],,&quot;regexp&quot;,&quot;running&quot;)=0</expression>
                                    <name>{$PVENODE} service {#PVENODESERVICE} not running</name>
                                    <priority>AVERAGE</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>pveapi.node.master.services</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODESERVICEUNITSTATE}</lld_macro>
                            <path>$.['unit-state']</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVENODESERVICE}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>[]</error_handler_params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>41ea6936c8574a00884ec761766dc521</uuid>
                    <name>pveapi node discovery storage pools</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.storagepool</key>
                    <delay>0</delay>
                    <lifetime>5d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>1410e9b5e846476aa726ae9ba897dd08</uuid>
                            <name>storage pool {#PVENODESTORAGEPOOL} size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.storage==&quot;{#PVENODESTORAGEPOOL}&quot;)].total.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.storagepools</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>8344791aba89461580c9d5056cf3c60a</uuid>
                            <name>storage pool {#PVENODESTORAGEPOOL} used</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.storage==&quot;{#PVENODESTORAGEPOOL}&quot;)].used.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.storagepools</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>4e37be1434ed4100a2898747818a9c85</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}])/
last(/Template pve api node/pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}])))
&gt; 98</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}])/
last(/Template pve api node/pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}])))
&lt; 95</recovery_expression>
                            <name>{$PVENODE} storage pool {#PVENODESTORAGEPOOL} less then 2% free</name>
                            <priority>DISASTER</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>5f1356ccc6854166b67cc6d5b365dc6f</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}])/
last(/Template pve api node/pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}])))
&gt; 90</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}])/
last(/Template pve api node/pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}])))
&lt; 88</recovery_expression>
                            <name>{$PVENODE} storage pool {#PVENODESTORAGEPOOL} less then 10% free</name>
                            <priority>HIGH</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>992e85eb342a4880816adf7d1be0ae02</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}])/
last(/Template pve api node/pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}])))
&gt; 80</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}])/
last(/Template pve api node/pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}])))
&lt; 75</recovery_expression>
                            <name>{$PVENODE} storage pool {#PVENODESTORAGEPOOL} less then 20% free</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>6370e59a69954921ab109c9cd3bd94ec</uuid>
                            <name>storage pool {#PVENODESTORAGEPOOL} usage ({#PVENODESTORAGEPOOLTYPE})</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>Template pve api node</host>
                                <key>pveapi.node.storagepool.size[{#PVENODESTORAGEPOOL}]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.storagepool.used[{#PVENODESTORAGEPOOL}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.node.master.storagepools</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODESTORAGEPOOLTYPE}</lld_macro>
                            <path>$.type</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PVENODESTORAGEPOOL}</lld_macro>
                            <path>$.storage</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>[]</error_handler_params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>f07000f8fc104c568c5624be6a44d268</uuid>
                    <name>pveapi node discovery zfs</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.node.discovery.zfs</key>
                    <delay>0</delay>
                    <lifetime>5d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>662c0ff1f13c4778b59c935b2a28bebb</uuid>
                            <name>zpool {#PVENODEZFSPOOL} allocated</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.name==&quot;{#PVENODEZFSPOOL}&quot;)].alloc.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.zfs</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>5d873f1df39c489d8a849c8ccd7b190f</uuid>
                            <name>zpool {#PVENODEZFSPOOL} fragmented</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.zfs.frag[{#PVENODEZFSPOOL}]</key>
                            <delay>0</delay>
                            <units>%</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.name==&quot;{#PVENODEZFSPOOL}&quot;)].frag.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.zfs</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>c0c9c10bda0f4ff1a5ac6279f2da303b</uuid>
                            <name>zpool {#PVENODEZFSPOOL} health</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.zfs.health[{#PVENODEZFSPOOL}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.name==&quot;{#PVENODEZFSPOOL}&quot;)].health.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.zfs</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>a1dad15633944c9784dac5277af9fd2d</uuid>
                                    <expression>find(/Template pve api node/pveapi.node.zfs.health[{#PVENODEZFSPOOL}],,&quot;regexp&quot;,&quot;ONLINE&quot;)=0</expression>
                                    <name>{$PVENODE} zpool {#PVENODEZFSPOOL} health failed</name>
                                    <priority>DISASTER</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>63d8dfec0a3a4cf3a6e2d6d382351cc1</uuid>
                            <name>zpool {#PVENODEZFSPOOL} size</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.node.zfs.size[{#PVENODEZFSPOOL}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.[?(@.name==&quot;{#PVENODEZFSPOOL}&quot;)].size.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.node.master.zfs</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Node</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>ed68b3bd2bc548029441ea3051402c33</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}])/
last(/Template pve api node/pveapi.node.zfs.size[{#PVENODEZFSPOOL}])))
&gt; 98</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}])/
last(/Template pve api node/pveapi.node.zfs.size[{#PVENODEZFSPOOL}])))
&lt; 95</recovery_expression>
                            <name>{$PVENODE} zpool {#PVENODEZFSPOOL} less then 2% free</name>
                            <priority>DISASTER</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>6d9fad5a1fa2472281a00a740d75f723</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}])/
last(/Template pve api node/pveapi.node.zfs.size[{#PVENODEZFSPOOL}])))
&gt; 90</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}])/
last(/Template pve api node/pveapi.node.zfs.size[{#PVENODEZFSPOOL}])))
&lt; 88</recovery_expression>
                            <name>{$PVENODE} zpool {#PVENODEZFSPOOL} less then 10% free</name>
                            <priority>HIGH</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>8ab8326e7241438da949a45476e1705b</uuid>
                            <expression>(100*(last(/Template pve api node/pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}])/
last(/Template pve api node/pveapi.node.zfs.size[{#PVENODEZFSPOOL}])))
&gt; 80</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>(100*(last(/Template pve api node/pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}])/
last(/Template pve api node/pveapi.node.zfs.size[{#PVENODEZFSPOOL}])))
&lt; 75</recovery_expression>
                            <name>{$PVENODE} zpool {#PVENODEZFSPOOL} less then 20% free</name>
                            <priority>WARNING</priority>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>de21248b22f04ba99fa55b0fbdc81f0a</uuid>
                            <name>zpool {#PVENODEZFSPOOL} fragmentation</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>FIXED</ymax_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>2774A4</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.zfs.frag[{#PVENODEZFSPOOL}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>14e45ab604cd4f2a9684fe0ecda29022</uuid>
                            <name>zpool {#PVENODEZFSPOOL} usage ({?last(//pveapi.node.zfs.health[{#PVENODEZFSPOOL}])})</name>
                            <type>STACKED</type>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>Template pve api node</host>
                                <key>pveapi.node.zfs.size[{#PVENODEZFSPOOL}]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template pve api node</host>
                                        <key>pveapi.node.zfs.alloc[{#PVENODEZFSPOOL}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.node.master.zfs</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVENODEZFSPOOL}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>[]</error_handler_params>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <dashboards>
                <dashboard>
                    <uuid>1b86be8ebf6d4b02b306731fb904588d</uuid>
                    <name>Disk</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>graphprototype</type>
                                    <width>24</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>ITEM_PROTOTYPE</type>
                                            <name>itemid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <key>pveapi.node.disk.wearout[{#PVENODEDISK}]</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>source_type</name>
                                            <value>3</value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
                <dashboard>
                    <uuid>9a47637bd79a46749a2ec160d1f3e527</uuid>
                    <name>LVM storage</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>graphprototype</type>
                                    <width>24</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>LVM {#PVENODELVM} used</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
                <dashboard>
                    <uuid>50344a667bbd43c19b6196e528efdbd3</uuid>
                    <name>LVMThin storage</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>graphprototype</type>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>LVMThin {#PVENODELVMTHIN} usage</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graphprototype</type>
                                    <x>12</x>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>LVMThin {#PVENODELVMTHIN} metadata usage</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
                <dashboard>
                    <uuid>fc842eb7c3a64880803b22487866ebf2</uuid>
                    <name>Overview</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>plaintext</type>
                                    <width>12</width>
                                    <fields>
                                        <field>
                                            <type>ITEM</type>
                                            <name>itemids</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <key>pveapi.node.pveversion</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show_lines</name>
                                            <value>1</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <y>2</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>CPU ({?last(//pveapi.node.cpus)} CPU(s))</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <y>7</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>Memory ({?last(//pveapi.node.mem.total)})</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <y>12</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>Root filesystem ({?last(//pveapi.node.rootfs.total)})</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>plaintext</type>
                                    <x>12</x>
                                    <width>12</width>
                                    <fields>
                                        <field>
                                            <type>ITEM</type>
                                            <name>itemids</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <key>pveapi.node.kernelversion</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show_lines</name>
                                            <value>1</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <x>12</x>
                                    <y>2</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>Load average</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <x>12</x>
                                    <y>7</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>Swap ({?last(//pveapi.node.swap.total)})</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <x>12</x>
                                    <y>12</y>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>KSM</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
                <dashboard>
                    <uuid>bae80eb739e2403292427209cbe09c3b</uuid>
                    <name>Storage pools</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>graphprototype</type>
                                    <width>24</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>storage pool {#PVENODESTORAGEPOOL} usage ({#PVENODESTORAGEPOOLTYPE})</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
                <dashboard>
                    <uuid>19ff18fa0d4f404d8a3633b6d53bac72</uuid>
                    <name>ZFS storage</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>graphprototype</type>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>zpool {#PVENODEZFSPOOL} usage ({?last(//pveapi.node.zfs.health[{#PVENODEZFSPOOL}])})</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graphprototype</type>
                                    <x>12</x>
                                    <width>12</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api node</host>
                                                <name>zpool {#PVENODEZFSPOOL} fragmentation</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
            </dashboards>
        </template>
        <template>
            <uuid>a8d4a7cdccb048a2a0b009a95a0df38e</uuid>
            <template>Template pve api qemu</template>
            <name>Template pve api qemu</name>
            <description>This template is used by Template pve api datacenter. Please don't use directly.</description>
            <templates>
                <template>
                    <name>Template pve api settings</name>
                </template>
            </templates>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>a599be1052eb48009fe2d67a87638b79</uuid>
                    <name>CPU</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.cpu</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>%</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.cpu</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>100</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>b6a0a6adb61849399e5596c5cb8d7ea5</uuid>
                    <name>CPUs</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.cpus</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.cpus</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>df398a06f094467fb5ef03d08db0bde4</uuid>
                    <name>pveapi qemu master snapshot</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.qemu.master.snapshot</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/qemu/{$PVEQEMUID}/snapshot</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>79e76be185f74002ad4c21ba90e448d4</uuid>
                    <name>pveapi qemu master status</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.qemu.master.status</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/nodes/{$PVENODE}/qemu/{$PVEQEMUID}/status/current</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>2697dee24c244ecaa7db80a5fb6a1e26</uuid>
                    <name>Disk size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.maxdisk</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.maxdisk</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e972242357e9467899014bededb1a55c</uuid>
                    <name>Memory size</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.maxmem</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.maxmem</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>cd103325e3ba49da98e7146383878d0c</uuid>
                    <name>Memory used</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.mem</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.mem</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>ff026525c014421da9409aa0544880d2</uuid>
                    <name>Memory free</name>
                    <type>CALCULATED</type>
                    <key>pveapi.qemu.memfree</key>
                    <units>%</units>
                    <params>100*((last(//pveapi.qemu.maxmem) - last(//pveapi.qemu.mem)) / last(//pveapi.qemu.maxmem))</params>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>ae737e66d8d24a7d80cbb73487eed3dc</uuid>
                    <name>Pool check</name>
                    <type>HTTP_AGENT</type>
                    <key>pveapi.qemu.poolcheck</key>
                    <delay>15m</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.poolid==&quot;{$PVEQEMUPOOL}&quot;)].poolid.first()</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>__</error_handler_params>
                        </step>
                        <step>
                            <type>MATCHES_REGEX</type>
                            <parameters>
                                <parameter>{$PVENOPROBLEMPOOL}</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>1</error_handler_params>
                        </step>
                        <step>
                            <type>IN_RANGE</type>
                            <parameters>
                                <parameter>1</parameter>
                                <parameter>2</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>0</error_handler_params>
                        </step>
                    </preprocessing>
                    <timeout>10s</timeout>
                    <url>https://{$PVESERVER}:8006/api2/json/pools</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVETOKENID}={$PVESECRET}</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>61a796b2d0bc43219c42d44860f49972</uuid>
                    <name>Status</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.status</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.status</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>9d933a515fc84302a027f0d8c455f05a</uuid>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.uptime</key>
                    <delay>0</delay>
                    <units>uptime</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.uptime</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>PVE Qemu</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>78039a1467e445ab8f841abb373cf201</uuid>
                    <name>pveapi qemu discovery blockdevice</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.discovery.blockdev</key>
                    <delay>0</delay>
                    <lifetime>5d</lifetime>
                    <description>Discover blockdevices for qemu.
The preprocessing is pretty gross. Need to modify an array to items with names.</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>48a5912cd74f4ca19e6438434e60c2e8</uuid>
                            <name>{#PVEQEMUBLOCKDEV} read iops</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.blockdev.readiops[{#PVEQEMUBLOCKDEV}]</key>
                            <delay>0</delay>
                            <units>iops</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.blockstat.{#PVEQEMUBLOCKDEV}.rd_operations</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Qemu</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>67c08312cab349baaee2c47aa7b439e1</uuid>
                            <name>{#PVEQEMUBLOCKDEV} read</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.blockdev.read[{#PVEQEMUBLOCKDEV}]</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <units>Bps</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.blockstat.{#PVEQEMUBLOCKDEV}.rd_bytes</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Qemu</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>7333f77875c54ecab85661f72e3686a8</uuid>
                            <name>{#PVEQEMUBLOCKDEV} write iops</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.blockdev.writeiops[{#PVEQEMUBLOCKDEV}]</key>
                            <delay>0</delay>
                            <units>iops</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.blockstat.{#PVEQEMUBLOCKDEV}.wr_operations</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Qemu</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>ea700e8f9f6c4315956a9bb53ac250bb</uuid>
                            <name>{#PVEQEMUBLOCKDEV} write</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.blockdev.write[{#PVEQEMUBLOCKDEV}]</key>
                            <delay>0</delay>
                            <units>Bps</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.blockstat.{#PVEQEMUBLOCKDEV}.wr_bytes</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Qemu</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>d95a6e04ca7a45b096983f924b06fe0e</uuid>
                            <name>{#PVEQEMUBLOCKDEV} iops</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>2774A4</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.blockdev.readiops[{#PVEQEMUBLOCKDEV}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F7941D</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.blockdev.writeiops[{#PVEQEMUBLOCKDEV}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>9f3ed030ed6b44b2b3bcce8ca93b3a51</uuid>
                            <name>{#PVEQEMUBLOCKDEV} read/write</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.blockdev.read[{#PVEQEMUBLOCKDEV}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.blockdev.write[{#PVEQEMUBLOCKDEV}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUBLOCKDEV}</lld_macro>
                            <path>$.blockdev</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.blockstat[*]~</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>,&quot;</parameter>
                                <parameter>},{&quot;blockdev&quot;:&quot;</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>[</parameter>
                                <parameter>[{&quot;blockdev&quot;:</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>]</parameter>
                                <parameter>}]</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>blockdev&quot;:}</parameter>
                                <parameter>blockdev&quot;:&quot;&quot;}</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>NOT_MATCHES_REGEX</type>
                            <parameters>
                                <parameter>^$</parameter>
                            </parameters>
                            <error_handler>CUSTOM_VALUE</error_handler>
                            <error_handler_params>[]</error_handler_params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>36a488e04b844f859ef0e11d1073b484</uuid>
                    <name>pveapi qemu discovery nic</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.discovery.nic</key>
                    <delay>0</delay>
                    <lifetime>5d</lifetime>
                    <description>Discover network interfaces for qemu.
The preprocessing is pretty gross. Need to modify an array to items with names.</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>b7c1cade63774edb91784f6f664a0727</uuid>
                            <name>{#PVEQEMUNIC} in</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.nic.in[{#PVEQEMUNIC}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.nics.{#PVEQEMUNIC}.netin</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Qemu</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9ac8279b6ab744779ee01a627e17d0c4</uuid>
                            <name>{#PVEQEMUNIC} out</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.nic.out[{#PVEQEMUNIC}]</key>
                            <delay>0</delay>
                            <units>bps</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data.nics.{#PVEQEMUNIC}.netout</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>8</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.status</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Qemu</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>11690e98c47947608465c1f3693318bc</uuid>
                            <name>{#PVEQEMUNIC} traffic</name>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.nic.in[{#PVEQEMUNIC}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template pve api qemu</host>
                                        <key>pveapi.qemu.nic.out[{#PVEQEMUNIC}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>pveapi.qemu.master.status</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUNIC}</lld_macro>
                            <path>$.nic</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data.nics[*]~</parameter>
                            </parameters>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>,&quot;</parameter>
                                <parameter>},{&quot;nic&quot;:&quot;</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>[</parameter>
                                <parameter>[{&quot;nic&quot;:</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>]</parameter>
                                <parameter>}]</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>de4c8257d1b84a3fb3a8654185e99788</uuid>
                    <name>pveapi qemu discovery snapshot</name>
                    <type>DEPENDENT</type>
                    <key>pveapi.qemu.discovery.snapshot</key>
                    <delay>0</delay>
                    <lifetime>1h</lifetime>
                    <description>Discover snapshots for qemu.</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>492ae5de5a9341ff81c1cfa1e8db29c1</uuid>
                            <name>Snapshot {#PVEQEMUSNAPSHOT} check</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.snapshot.check[{#PVEQEMUSNAPSHOT}]</key>
                            <delay>0</delay>
                            <history>1h</history>
                            <trends>0</trends>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data[?(@.name==&quot;{#PVEQEMUSNAPSHOT}&quot; &amp;&amp; ! (@.name =~ &quot;^{$PVESNAPSHOTEXCLUDE}&quot;))].length()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.snapshot</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Qemu</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>615051719a2c41c9ae77ef7c07f14579</uuid>
                            <name>Snapshot {#PVEQEMUSNAPSHOT} create time</name>
                            <type>DEPENDENT</type>
                            <key>pveapi.qemu.snapshot.time[{#PVEQEMUSNAPSHOT}]</key>
                            <delay>0</delay>
                            <history>1h</history>
                            <trends>0</trends>
                            <units>unixtime</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.body.data[?(@.name==&quot;{#PVEQEMUSNAPSHOT}&quot;)].snaptime.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pveapi.qemu.master.snapshot</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>PVE Qemu</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>ba6e363ea9d2435cbac52f3deed54583</uuid>
                            <expression>now()-
last(/Template pve api qemu/pveapi.qemu.snapshot.time[{#PVEQEMUSNAPSHOT}])&gt;{$PVESNAPSHOTAGE} and last(/Template pve api qemu/pveapi.qemu.snapshot.check[{#PVEQEMUSNAPSHOT}])=1</expression>
                            <name>{$PVEQEMUNAME} snapshot {#PVEQEMUSNAPSHOT} too old</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <master_item>
                        <key>pveapi.qemu.master.snapshot</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#PVEQEMUSNAPSHOT}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.data[?(@.name!=&quot;current&quot;)]</parameter>
                            </parameters>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <dashboards>
                <dashboard>
                    <uuid>d6d7baf27a704d6e8e2af41ab520c37a</uuid>
                    <name>Qemu overview</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>plaintext</type>
                                    <width>8</width>
                                    <fields>
                                        <field>
                                            <type>ITEM</type>
                                            <name>itemids</name>
                                            <value>
                                                <host>Template pve api qemu</host>
                                                <key>pveapi.qemu.status</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show_lines</name>
                                            <value>1</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <y>2</y>
                                    <width>8</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api qemu</host>
                                                <name>CPU ({?last(//pveapi.qemu.cpus)} CPU(s))</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graphprototype</type>
                                    <y>7</y>
                                    <width>8</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api qemu</host>
                                                <name>{#PVEQEMUNIC} traffic</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <x>8</x>
                                    <y>2</y>
                                    <width>8</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api qemu</host>
                                                <name>Memory usage</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graphprototype</type>
                                    <x>8</x>
                                    <y>7</y>
                                    <width>8</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api qemu</host>
                                                <name>{#PVEQEMUBLOCKDEV} read/write</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graph</type>
                                    <x>16</x>
                                    <y>2</y>
                                    <width>8</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api qemu</host>
                                                <name>Uptime</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>graphprototype</type>
                                    <x>16</x>
                                    <y>7</y>
                                    <width>8</width>
                                    <height>5</height>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>columns</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Template pve api qemu</host>
                                                <name>{#PVEQEMUBLOCKDEV} iops</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
            </dashboards>
        </template>
        <template>
            <uuid>3c6064fc2835496ab65ef99890193928</uuid>
            <template>Template pve api settings</template>
            <name>Template pve api settings</name>
            <description>This template only contains configuration macro's with default values.</description>
            <groups>
                <group>
                    <name>Production</name>
                </group>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <macros>
                <macro>
                    <macro>{$PVELOCKTIME}</macro>
                    <value>2h</value>
                    <description>Alert if lxc or qemu is locked for this long</description>
                </macro>
                <macro>
                    <macro>{$PVENOPROBLEMPOOL}</macro>
                    <value>^test$</value>
                    <description>Systems in pools matching this regex will not generate problems</description>
                </macro>
                <macro>
                    <macro>{$PVESNAPSHOTAGE}</macro>
                    <value>1w</value>
                    <description>Alert if snapshots older than 1 week (default)</description>
                </macro>
                <macro>
                    <macro>{$PVESNAPSHOTEXCLUDE}</macro>
                    <value>test</value>
                    <description>Ignore snapshots starting with this text</description>
                </macro>
                <macro>
                    <macro>{$PVETASKTIME}</macro>
                    <value>86400</value>
                    <description>Alert if tasks fail between now and value seconds ago</description>
                </macro>
            </macros>
        </template>
    </templates>
    <triggers>
        <trigger>
            <uuid>28fceca8f438401cb5e766e2f08ee296</uuid>
            <expression>avg(/Template pve api lxc/pveapi.lxc.cpu,15m)&gt;80 and last(/Template pve api lxc/pveapi.lxc.poolcheck)=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>avg(/Template pve api lxc/pveapi.lxc.cpu,15m)&lt;70</recovery_expression>
            <name>CPU over 80% for last 15 minutes on {$PVELXCNAME}</name>
            <priority>WARNING</priority>
            <description>{$PVELXCNAME} has more then 80% CPU usage over the last 15 minutes</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>054dc8555f5d4112b2bcd0357b4b8726</uuid>
            <expression>(avg(/Template pve api node/pveapi.node.cpu.user,15m) + avg(/Template pve api node/pveapi.node.cpu.wait,15m)) &gt; 80</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>(avg(/Template pve api node/pveapi.node.cpu.user,15m) + avg(/Template pve api node/pveapi.node.cpu.wait,15m)) &lt; 70</recovery_expression>
            <name>CPU over 80% for last 15 minutes on {$PVENODE}</name>
            <priority>WARNING</priority>
            <description>{$PVENODE} has more then 80% CPU usage over the last 15 minutes</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>be8f355436334ef08dd5d049ea0811b1</uuid>
            <expression>avg(/Template pve api qemu/pveapi.qemu.cpu,15m)&gt;80 and last(/Template pve api qemu/pveapi.qemu.poolcheck)=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>avg(/Template pve api qemu/pveapi.qemu.cpu,15m)&lt;70</recovery_expression>
            <name>CPU over 80% for last 15 minutes on {$PVEQEMUNAME}</name>
            <priority>WARNING</priority>
            <description>{$PVEQEMUNAME} has more then 80% CPU usage over the last 15 minutes</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>6f33c9431fb64dfca9116494c61dc1ff</uuid>
            <expression>avg(/Template pve api lxc/pveapi.lxc.diskfree,10m)&lt;1 and last(/Template pve api lxc/pveapi.lxc.poolcheck)=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>avg(/Template pve api lxc/pveapi.lxc.diskfree,10m)&gt;3</recovery_expression>
            <name>Disk full on {$PVELXCNAME}</name>
            <priority>DISASTER</priority>
            <description>{$PVELXCNAME} has no diskspace left over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>464011111d7f4b07aed59fa16e169bbf</uuid>
            <expression>avg(/Template pve api lxc/pveapi.lxc.diskfree,10m)&lt;5 and last(/Template pve api lxc/pveapi.lxc.poolcheck)=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>avg(/Template pve api lxc/pveapi.lxc.diskfree,10m)&gt;7</recovery_expression>
            <name>Disk less than 5% free on {$PVELXCNAME}</name>
            <priority>HIGH</priority>
            <description>{$PVELXCNAME} has less then 5% diskspace free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>c821468ee95a4957beebb8f72b2666e5</uuid>
            <expression>avg(/Template pve api lxc/pveapi.lxc.diskfree,10m)&lt;10 and
avg(/Template pve api lxc/pveapi.lxc.diskfree,10m)&gt;5 and last(/Template pve api lxc/pveapi.lxc.poolcheck)=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>avg(/Template pve api lxc/pveapi.lxc.diskfree,10m)&gt;15</recovery_expression>
            <name>Disk less than 10% free on {$PVELXCNAME}</name>
            <priority>WARNING</priority>
            <description>{$PVELXCNAME} has less then 10% diskspace free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>7a44e7643758414895b00c12d6a7bd97</uuid>
            <expression>avg(/Template pve api lxc/pveapi.lxc.memfree,10m)&lt;5 and last(/Template pve api lxc/pveapi.lxc.poolcheck)=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>avg(/Template pve api lxc/pveapi.lxc.memfree,10m)&gt;10</recovery_expression>
            <name>Memory less than 5% free on {$PVELXCNAME}</name>
            <priority>WARNING</priority>
            <description>{$PVELXCNAME} has less then 5% memory + swap free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>a8c1d3abe6c34a0daabf662638053df9</uuid>
            <expression>(100*(avg(/Template pve api node/pveapi.node.mem.used,10m)/avg(/Template pve api node/pveapi.node.mem.total,10m))) &gt; 95</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>(100*(avg(/Template pve api node/pveapi.node.mem.used,10m)/avg(/Template pve api node/pveapi.node.mem.total,10m))) &lt; 80</recovery_expression>
            <name>Memory less than 5% free on {$PVENODE}</name>
            <priority>WARNING</priority>
            <description>{$PVENODE} has less then 5% memory + swap free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>ebf09145336644448ee560e8c4036c54</uuid>
            <expression>avg(/Template pve api qemu/pveapi.qemu.memfree,10m)&lt;5 and last(/Template pve api qemu/pveapi.qemu.poolcheck)=1</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>avg(/Template pve api qemu/pveapi.qemu.memfree,10m)&gt;10</recovery_expression>
            <name>Memory less than 5% free on {$PVEQEMUNAME}</name>
            <priority>WARNING</priority>
            <description>{$PVEQEMUNAME} has less then 5% memory free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>4d54c5672bea4abebe549a8d233afac6</uuid>
            <expression>(100* (avg(/Template pve api node/pveapi.node.rootfs.used,10m) / avg(/Template pve api node/pveapi.node.rootfs.total,10m))) &gt; 90</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>(100* (avg(/Template pve api node/pveapi.node.rootfs.used,10m) / avg(/Template pve api node/pveapi.node.rootfs.total,10m))) &lt; 80</recovery_expression>
            <name>RootFS has less than 10% free on {$PVENODE}</name>
            <priority>WARNING</priority>
            <description>{$PVENODE} has less then 10% diskspace free over the last 10 minutes</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>ceeccc264de443d79832172ed6bf683b</uuid>
            <expression>(100*(avg(/Template pve api node/pveapi.node.swap.used,10m)/avg(/Template pve api node/pveapi.node.swap.total,10m))) &gt; 50</expression>
            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
            <recovery_expression>(100*(avg(/Template pve api node/pveapi.node.swap.used,10m)/avg(/Template pve api node/pveapi.node.swap.total,10m))) &lt; 40</recovery_expression>
            <name>Swap more than 50% used on {$PVENODE}</name>
            <priority>WARNING</priority>
            <description>{$PVENODE} has less then 5% memory + swap free over the last 10 minutes.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>c79d48b2f7c04454a39c2a4950ba8e21</uuid>
            <expression>(count(/Template pve api lxc/pveapi.lxc.lock,{$PVELOCKTIME}) =  count(/Template pve api lxc/pveapi.lxc.lock,{$PVELOCKTIME},&quot;ne&quot;,&quot;&quot;)) and last(/Template pve api lxc/pveapi.lxc.poolcheck)=1</expression>
            <name>{$PVELXCNAME} is locked: {ITEM.LASTVALUE1}</name>
            <priority>AVERAGE</priority>
            <description>{$PVELXCNAME} is stopped.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>03937bcc04b84ae7b9285887c290991b</uuid>
            <expression>change(/Template pve api lxc/pveapi.lxc.uptime)&lt;0 and find(/Template pve api lxc/pveapi.lxc.status,,&quot;regexp&quot;,&quot;running&quot;)=1 and last(/Template pve api lxc/pveapi.lxc.poolcheck)=1</expression>
            <name>{$PVELXCNAME} is restarted</name>
            <priority>INFO</priority>
            <description>{$PVELXCNAME} restarted</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>cafb6176baca41e5b40d7840e70d5b77</uuid>
            <expression>find(/Template pve api lxc/pveapi.lxc.status,,&quot;regexp&quot;,&quot;stopped&quot;)=1 and last(/Template pve api lxc/pveapi.lxc.poolcheck)=1</expression>
            <name>{$PVELXCNAME} is stopped</name>
            <priority>WARNING</priority>
            <description>{$PVELXCNAME} is stopped.</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>3162a28e319c4c71a233a3da6bbc3a69</uuid>
            <expression>change(/Template pve api qemu/pveapi.qemu.uptime)&lt;0 and last(/Template pve api qemu/pveapi.qemu.poolcheck)=1</expression>
            <name>{$PVEQEMUNAME} is restarted</name>
            <priority>INFO</priority>
            <description>{$PVEQEMUNAME} restarted</description>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <uuid>d3291775d6d34716b045d6eb0564bff9</uuid>
            <expression>find(/Template pve api qemu/pveapi.qemu.status,,&quot;regexp&quot;,&quot;stopped&quot;)=1 and last(/Template pve api qemu/pveapi.qemu.poolcheck)=1</expression>
            <name>{$PVEQEMUNAME} is stopped</name>
            <priority>WARNING</priority>
            <description>{$PVEQEMUNAME} is stopped.</description>
            <manual_close>YES</manual_close>
        </trigger>
    </triggers>
    <graphs>
        <graph>
            <uuid>17711dcdd56d4776825ba0785f7b71f9</uuid>
            <name>Cluster status</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api datacenter</host>
                <key>pveapi.datacenter.clusternodes</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api datacenter</host>
                        <key>pveapi.datacenter.clusternodesonline</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>5b4dc88108884e82a8c5673610a6514c</uuid>
            <name>Cluster tasks</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api datacenter</host>
                        <key>pveapi.datacenter.tasks.failed</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api datacenter</host>
                        <key>pveapi.datacenter.tasks.running</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>3</sortorder>
                    <color>2774A4</color>
                    <item>
                        <host>Template pve api datacenter</host>
                        <key>pveapi.datacenter.tasks.total</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>ed4c6e14170240f982a6bb51dc4d3f54</uuid>
            <name>CPU</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>FIXED</ymax_type_1>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.cpu</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>5ce7f0383dd943f882dd227e15b19434</uuid>
            <name>CPU ({?last(//pveapi.node.cpus)} CPU(s))</name>
            <type>STACKED</type>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>FIXED</ymax_type_1>
            <graph_items>
                <graph_item>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.cpu.wait</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>FFBF00</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.cpu.user</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>2756efd0d0804c68887e40ef8cf11124</uuid>
            <name>CPU ({?last(//pveapi.qemu.cpus)} CPU(s))</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>FIXED</ymax_type_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api qemu</host>
                        <key>pveapi.qemu.cpu</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>30a295a98e894914b7f579207867aa51</uuid>
            <name>Disk IO</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.diskread</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.diskwrite</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>209c30c754c4470fa373ec4a566db1ff</uuid>
            <name>Disk usage</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api lxc</host>
                <key>pveapi.lxc.maxdisk</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>33FF33</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.maxdisk</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.disk</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>da065cb1c74645afa448db54e843c85c</uuid>
            <name>KSM</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.ksm</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>48e6d5c9d3ba4c4a98ad6b4799f4fae4</uuid>
            <name>Load average</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.load</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>93e4946986954138a9937b4a49513eb5</uuid>
            <name>Memory ({?last(//pveapi.node.mem.total)})</name>
            <type>STACKED</type>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api node</host>
                <key>pveapi.node.mem.total</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.mem.used</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>4ebd16aeb4204082afb4027a42486abf</uuid>
            <name>Memory usage</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api lxc</host>
                <key>pveapi.lxc.maxmem</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>33FF33</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.maxmem</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.mem</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>3c1a73e6210940dbb5018b50f3e2f79c</uuid>
            <name>Memory usage</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api qemu</host>
                <key>pveapi.qemu.maxmem</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>33FF33</color>
                    <item>
                        <host>Template pve api qemu</host>
                        <key>pveapi.qemu.maxmem</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api qemu</host>
                        <key>pveapi.qemu.mem</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>6b02387e5dc949919744d8d933545aa9</uuid>
            <name>Network traffic</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.netin</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.netout</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>9745339a53d14b999368f586bb0a15e7</uuid>
            <name>Root filesystem ({?last(//pveapi.node.rootfs.total)})</name>
            <show_triggers>NO</show_triggers>
            <type>STACKED</type>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api node</host>
                <key>pveapi.node.rootfs.total</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.rootfs.used</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>2df757218b1142dc9430899652310901</uuid>
            <name>Swap ({?last(//pveapi.node.swap.total)})</name>
            <type>STACKED</type>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api node</host>
                <key>pveapi.node.swap.total</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.swap.used</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>5c2cbb4994c14e7b99b7428a9f094b92</uuid>
            <name>Swap usage</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>ITEM</ymax_type_1>
            <ymax_item_1>
                <host>Template pve api lxc</host>
                <key>pveapi.lxc.maxswap</key>
            </ymax_item_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>33FF33</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.maxswap</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.swap</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>a5dc864387ec40e5b4a1946ac9b7d1af</uuid>
            <name>Uptime</name>
            <show_work_period>NO</show_work_period>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api lxc</host>
                        <key>pveapi.lxc.uptime</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>d4eaf88662584c3088570b86b74b2f00</uuid>
            <name>Uptime</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>F63100</color>
                    <item>
                        <host>Template pve api node</host>
                        <key>pveapi.node.uptime</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>cb7ad77697d641c9b4f4d4ae65932014</uuid>
            <name>Uptime</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <drawtype>FILLED_REGION</drawtype>
                    <color>199C0D</color>
                    <item>
                        <host>Template pve api qemu</host>
                        <key>pveapi.qemu.uptime</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
</zabbix_export>
